=== kursach/src/core/Track.h ===
#ifndef TRACK_H
#define TRACK_H

#include <QString>

struct TrackData {  // ‚Üê –∏–∑–º–µ–Ω–∏—Ç–µ –∏–º—è
    int id;
    QString filePath;
    QString fileHash;
    QString title;
    QString artist;
    QString album;
    int duration;
    int playCount;
    QString addedAt;
    QString genre;
    int year;
    int bitrate;
    int sampleRate;
    int position;
};

#endif // TRACK_H

=== kursach/src/core/Playlist.cpp ===
#include "Playlist.h"

=== kursach/src/core/Track.cpp ===
#include "Track.h"


=== kursach/src/core/Playlist.h ===
#ifndef PLAYLIST_H
#define PLAYLIST_H

#include <QString>

struct Playlist {
    int id = -1;
    int userId = -1;
    QString name;
    QString createdAt;
};

#endif


=== kursach/src/gui/MainWindow/MainWindow.cpp ===
#include <QVBoxLayout>
#include <QBitmap>
#include <QHBoxLayout>
#include <QStackedWidget>
#include <QLabel>
#include <QPushButton>
#include <QFrame>
#include <QLineEdit>
#include <QListWidget>
#include <QTextEdit>
#include <QListWidgetItem>
#include <QRadialGradient>
#include <QFileDialog>
#include <QMessageBox>
#include <QDir>
#include <QFile>
#include <QPixmap>
#include <QPainter>
#include <QPainterPath>
#include <QTime>
#include <QToolButton>
#include <QStyle>
#include <QTimer>
#include <QApplication>
#include <QMenu>
#include <QEvent>
#include <QGraphicsDropShadowEffect>
#include <QPropertyAnimation>
#include <QParallelAnimationGroup>
#include <QScrollArea>
#include <QScrollBar>
#include <QDebug>

#include "MainWindow.h"
#include "../../database/DatabaseManager.h"
#include "../../database/api/MusicAPIManager.h"
#include "../../audio/AudioPlayer.h"
#include "../../core/Track.h"
#include "../Frameless/FramelessWindow.h"

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–∫–æ–Ω–æ–∫ —Å—Ç–∞—Ç—É—Å–∞
QIcon createStatusIcon(const QString& color) {
    QPixmap pixmap(8, 8);
    pixmap.fill(Qt::transparent);
    QPainter painter(&pixmap);
    painter.setRenderHint(QPainter::Antialiasing);
    painter.setBrush(QColor(color));
    painter.setPen(Qt::NoPen);
    painter.drawEllipse(0, 0, 8, 8);
    return QIcon(pixmap);
}

class TrackListWidgetItem : public QListWidgetItem {
public:
    TrackListWidgetItem(const QString& text, int trackId, QListWidget* parent = nullptr)
        : QListWidgetItem(text, parent), m_trackId(trackId) {}
    
    int trackId() const { return m_trackId; }
    
private:
    int m_trackId;
};

MainWindow::MainWindow(const QString& username, int userId, QWidget *parent)
    : FramelessWindow(parent)
    , currentUsername(username)
    , currentUserId(userId)
    , sidebar(nullptr)
    , avatarButton(nullptr)
    , avatarOverlay(nullptr)
    , usernameLabel(nullptr)
    , profileBtn(nullptr)
    , messagesBtn(nullptr)
    , friendsBtn(nullptr)
    , notificationsBtn(nullptr)
    , playlistBtn(nullptr)
    , musicSearchBtn(nullptr)
    , myMusicBtn(nullptr)
    , roomsBtn(nullptr)
    , mainStack(nullptr)
    , profilePage(nullptr)
    , messagesPage(nullptr)
    , friendsPage(nullptr)
    , notificationsPage(nullptr)
    , playlistPage(nullptr)
    , musicPage(nullptr)
    , myMusicPage(nullptr)
    , roomsPage(nullptr)
    , searchInput(nullptr)
    , searchButton(nullptr)
    , topTracksButton(nullptr)
    , tracksList(nullptr)
    , trackInfo(nullptr)
    , userTracksList(nullptr)
    , refreshTracksBtn(nullptr)
    , addLocalTrackBtn(nullptr)
    , apiManager(new MusicAPIManager(this))
    , audioPlayer(new AudioPlayer(this))
    , currentTrackIndex(-1)
{
    setupUI();
    setupConnections();
    setupAvatar(); 
    loadUserAvatar();
    loadUserTracks();
    
    setWindowTitle("SoundSpace - " + username);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
    QFile styleFile(":/styles/styles.css");
    if (styleFile.open(QIODevice::ReadOnly)) {
        QString styleSheet = QLatin1String(styleFile.readAll());
        setStyleSheet(styleSheet);
    }
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º eventFilter –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∫–∏
    avatarButton->installEventFilter(this);
    
    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
    setMinimumSize(1200, 750);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä
    resize(1400, 850);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —à—Ä–∏—Ñ—Ç
    QFont font = QApplication::font();
    font.setPointSize(10);
    QApplication::setFont(font);
}

MainWindow::~MainWindow()
{
    // –î–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä MainWindow
    // Qt –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ –≤–∏–¥–∂–µ—Ç—ã
    // —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ —Å–æ–∑–¥–∞–Ω—ã —Å this –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä–æ–¥–∏—Ç–µ–ª—è
}


bool MainWindow::eventFilter(QObject *obj, QEvent *event)
{
    if (obj == avatarButton) {
        if (event->type() == QEvent::Enter) {
            showAvatarOverlay();
            return true;
        } else if (event->type() == QEvent::Leave) {
            hideAvatarOverlay();
            return true;
        }
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –Ω–∞ –æ–≤–µ—Ä–ª–µ–µ
    if (obj == avatarOverlay) {
        if (event->type() == QEvent::MouseButtonPress) {
            changeAvatar();
            hideAvatarOverlay();
            return true;
        }
    }
    
    return FramelessWindow::eventFilter(obj, event);
}
void MainWindow::onAvatarButtonEnter()
{
    showAvatarOverlay();
}

void MainWindow::onAvatarButtonLeave()
{
    hideAvatarOverlay();
}

void MainWindow::showAvatarOverlay()
{
    if (!avatarOverlay) {
        // –°–æ–∑–¥–∞–µ–º –∫–∞–∫ –¥–æ—á–µ—Ä–Ω–∏–π –≤–∏–¥–∂–µ—Ç –∫–Ω–æ–ø–∫–∏
        avatarOverlay = new QLabel(avatarButton);
        avatarOverlay->setText("–°–º–µ–Ω–∏—Ç—å\n–∞–≤–∞—Ç–∞—Ä?");
        avatarOverlay->setStyleSheet(R"(
            QLabel {
                background-color: rgba(0, 0, 0, 0.85);
                color: white;
                font-weight: 600;
                font-size: 12px;
                border-radius: 50px;
                border: 2px solid rgba(138, 43, 226, 0.5);
                text-align: center;
                padding: 5px;
            }
        )");
        avatarOverlay->setAlignment(Qt::AlignCenter);
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ—Ç –∂–µ —Ä–∞–∑–º–µ—Ä, —á—Ç–æ –∏ —É –∞–≤–∞—Ç–∞—Ä–∫–∏
        avatarOverlay->setFixedSize(100, 100);
        
        // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –≤ (0,0) –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∞–≤–∞—Ç–∞—Ä–∫–∏
        avatarOverlay->move(0, 0);
        
        // –í–∞–∂–Ω–æ: –¥–µ–ª–∞–µ–º –æ–≤–µ—Ä–ª–µ–π "–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º" –¥–ª—è —Å–æ–±—ã—Ç–∏–π –º—ã—à–∏
        avatarOverlay->setAttribute(Qt::WA_TransparentForMouseEvents);
    }
    
    avatarOverlay->show();
    avatarOverlay->raise();
}

void MainWindow::hideAvatarOverlay()
{
    if (avatarOverlay) {
        avatarOverlay->hide();
    }
}

void MainWindow::setupUI()
{
    QWidget *centralWidget = new QWidget();
    centralWidget->setObjectName("windowContent");
    centralWidget->setStyleSheet(R"(
        #windowContent {
            background-color: #0F0F14;
            border-radius: 0;
        }
    )");
    
    QVBoxLayout *mainLayout = new QVBoxLayout(centralWidget);
    mainLayout->setSpacing(0);
    mainLayout->setContentsMargins(0, 0, 0, 0);
    
    // –ü–∞–Ω–µ–ª—å –∑–∞–≥–æ–ª–æ–≤–∫–∞
    QWidget *titleBar = new QWidget();
    titleBar->setFixedHeight(40);
    titleBar->setStyleSheet(R"(
        QWidget {
            background: rgba(15, 15, 20, 0.8);
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
    )");
    
    QHBoxLayout *titleLayout = new QHBoxLayout(titleBar);
    titleLayout->setContentsMargins(20, 0, 20, 0);
    
    QLabel *titleLabel = new QLabel("SoundSpace");
    titleLabel->setStyleSheet(R"(
        QLabel {
            color: #8A2BE2;
            font-size: 16px;
            font-weight: bold;
            opacity: 0.9;
        }
    )");
    
    QWidget *windowButtons = new QWidget();
    QHBoxLayout *buttonsLayout = new QHBoxLayout(windowButtons);
    buttonsLayout->setContentsMargins(0, 0, 0, 0);
    buttonsLayout->setSpacing(5);
    
    QPushButton *minimizeBtn = new QPushButton("‚Äî");
    QPushButton *maximizeBtn = new QPushButton("‚ñ°");
    QPushButton *closeBtn = new QPushButton("√ó");
    
    QString windowBtnStyle = R"(
        QPushButton {
            background: transparent;
            color: rgba(255, 255, 255, 0.6);
            border: none;
            font-size: 16px;
            padding: 0;
            min-width: 28px;
            min-height: 28px;
            border-radius: 4px;
            font-weight: 300;
        }
        QPushButton:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        QPushButton#closeBtn:hover {
            background: #FF4444;
            color: white;
        }
    )";
    
    minimizeBtn->setStyleSheet(windowBtnStyle);
    maximizeBtn->setStyleSheet(windowBtnStyle);
    closeBtn->setStyleSheet(windowBtnStyle);
    closeBtn->setObjectName("closeBtn");
    
    buttonsLayout->addWidget(minimizeBtn);
    buttonsLayout->addWidget(maximizeBtn);
    buttonsLayout->addWidget(closeBtn);
    
    titleLayout->addWidget(titleLabel);
    titleLayout->addStretch();
    titleLayout->addWidget(windowButtons);
    
    connect(minimizeBtn, &QPushButton::clicked, this, &QMainWindow::showMinimized);
    connect(closeBtn, &QPushButton::clicked, this, &QMainWindow::close);
    connect(maximizeBtn, &QPushButton::clicked, this, [this]() {
        if (isMaximized()) {
            showNormal();
        } else {
            showMaximized();
        }
    });
    
    QHBoxLayout *contentLayout = new QHBoxLayout();
    contentLayout->setSpacing(0);
    contentLayout->setContentsMargins(0, 0, 0, 0);
    
    createSidebar();
    contentLayout->addWidget(sidebar);
    
    createPages();
    contentLayout->addWidget(mainStack, 1);
    
    mainLayout->addWidget(titleBar);
    mainLayout->addLayout(contentLayout, 1);
    
    audioPlayer->setupPlayerControls(centralWidget);
    mainLayout->addWidget(audioPlayer->getPlayerControls());
    
    setCentralWidget(centralWidget);
}

void MainWindow::createSidebar()
{
    sidebar = new QWidget();
    sidebar->setFixedWidth(280);
    sidebar->setStyleSheet(R"(
        QWidget {
            background: #0F0F14;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }
    )");
    
    QVBoxLayout *sidebarLayout = new QVBoxLayout(sidebar);
    sidebarLayout->setContentsMargins(0, 0, 0, 0);
    sidebarLayout->setSpacing(0);
    
    // –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º
    QWidget *logoSection = new QWidget();
    logoSection->setFixedHeight(70);
    logoSection->setStyleSheet(R"(
        QWidget {
            background: rgba(138, 43, 226, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
    )");
    
    QHBoxLayout *logoLayout = new QHBoxLayout(logoSection);
    logoLayout->setContentsMargins(20, 0, 20, 0);
    
    QLabel *logoLabel = new QLabel("SoundSpace");
    logoLabel->setStyleSheet(R"(
        QLabel {
            color: #8A2BE2;
            font-size: 22px;
            font-weight: 800;
        }
    )");
    
    logoLayout->addWidget(logoLabel);
    sidebarLayout->addWidget(logoSection);
    
    // –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    QWidget *profileSection = new QWidget();
    profileSection->setStyleSheet(R"(
        QWidget {
            background: transparent;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
    )");
    
    QVBoxLayout *profileLayout = new QVBoxLayout(profileSection);
    profileLayout->setContentsMargins(0, 0, 0, 0);
    profileLayout->setSpacing(15);
    profileLayout->setAlignment(Qt::AlignTop);
    
    // –ê–≤–∞—Ç–∞—Ä
    avatarButton = new QPushButton();
    avatarButton->setFixedSize(100, 100);
    avatarButton->setStyleSheet(R"(
        QPushButton {
            border: 3px solid #8A2BE2;
            border-radius: 50px;
            padding: 0;
            background: transparent;
        }
        QPushButton:hover {
            border-color: #9B4BFF;
            background: rgba(138, 43, 226, 0.1);
        }
    )");
    
    QGraphicsDropShadowEffect *avatarEffect = new QGraphicsDropShadowEffect();
    avatarEffect->setBlurRadius(20);
    avatarEffect->setColor(QColor(138, 43, 226, 100));
    avatarEffect->setOffset(0, 0);
    avatarButton->setGraphicsEffect(avatarEffect);
    
    // –ù–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    usernameLabel = new QLabel(currentUsername);
    usernameLabel->setStyleSheet(R"(
        QLabel {
            color: #FFFFFF;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            padding: 10px 0 5px 0;
        }
    )");
    usernameLabel->setWordWrap(true);
    usernameLabel->setMaximumWidth(260);
    
    // –°—Ç–∞—Ç—É—Å - –∏—Å–ø–æ–ª—å–∑—É–µ–º QToolButton –¥–ª—è –º–µ–Ω—é
    QToolButton *statusButton = new QToolButton();
    statusButton->setText("–û–Ω–ª–∞–π–Ω");
    statusButton->setObjectName("statusButton");
    statusButton->setToolButtonStyle(Qt::ToolButtonTextOnly);
    statusButton->setArrowType(Qt::NoArrow);
    statusButton->setStyleSheet(R"(
        QToolButton {
            color: #4CAF50;
            font-size: 14px;
            font-weight: 500;
            background: transparent;
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 12px;
            padding: 6px 15px;
            margin: 0 70px;
        }
        QToolButton:hover {
            background: rgba(76, 175, 80, 0.1);
        }
        QToolButton::menu-indicator {
            width: 0px;
        }
    )");
    statusButton->setCursor(Qt::PointingHandCursor);
    
    profileLayout->addWidget(avatarButton, 0, Qt::AlignHCenter);
    profileLayout->addWidget(usernameLabel, 0, Qt::AlignHCenter);
    profileLayout->addWidget(statusButton, 0, Qt::AlignHCenter);
    sidebarLayout->addWidget(profileSection);
    
    // –ù–∞–≤–∏–≥–∞—Ü–∏—è
    QWidget *navSection = new QWidget();
    navSection->setStyleSheet("background: transparent;");
    
    QVBoxLayout *navLayout = new QVBoxLayout(navSection);
    navLayout->setContentsMargins(15, 20, 15, 20);
    navLayout->setSpacing(3);
    
    QString navButtonStyle = R"(
        QPushButton {
            background: transparent;
            color: rgba(255, 255, 255, 0.8);
            border: none;
            text-align: left;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 500;
            border-radius: 8px;
            min-height: 45px;
        }
        QPushButton:hover {
            color: #FFFFFF;
            background: rgba(138, 43, 226, 0.15);
            padding-left: 25px;
        }
        QPushButton:pressed {
            background: rgba(138, 43, 226, 0.25);
        }
    )";
    
    // –°–æ–∑–¥–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
    myMusicBtn = new QPushButton("–ú–æ—è –º—É–∑—ã–∫–∞");
    profileBtn = new QPushButton("–ü—Ä–æ—Ñ–∏–ª—å");
    musicSearchBtn = new QPushButton("–ü–æ–∏—Å–∫ –º—É–∑—ã–∫–∏");
    playlistBtn = new QPushButton("–ú–æ–∏ –ø–ª–µ–π–ª–∏—Å—Ç—ã");
    friendsBtn = new QPushButton("–î—Ä—É–∑—å—è");
    messagesBtn = new QPushButton("–°–æ–æ–±—â–µ–Ω–∏—è");
    notificationsBtn = new QPushButton("–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è");
    roomsBtn = new QPushButton("–ö–æ–º–Ω–∞—Ç—ã");
    
    QList<QPushButton*> navButtons = {
        myMusicBtn, profileBtn, musicSearchBtn, playlistBtn,
        friendsBtn, messagesBtn, notificationsBtn, roomsBtn
    };
    
    for (auto btn : navButtons) {
        btn->setStyleSheet(navButtonStyle);
        btn->setCursor(Qt::PointingHandCursor);
        navLayout->addWidget(btn);
    }
    
    navLayout->addStretch();
    sidebarLayout->addWidget(navSection, 1);
    
    // –ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å
    QWidget *bottomSection = new QWidget();
    bottomSection->setStyleSheet(R"(
        QWidget {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
    )");
    
    // –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
    QPushButton *logoutBtn = new QPushButton("–í—ã–π—Ç–∏");
    logoutBtn->setObjectName("logoutBtn");
    logoutBtn->setStyleSheet(R"(
        QPushButton {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid rgba(255, 68, 68, 0.3);
            color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 12px;
            font-size: 14px;
            font-weight: 500;
            width: 100%;
            min-height: 45px;
        }
        QPushButton:hover {
            background: rgba(255, 68, 68, 0.2);
            color: #FFFFFF;
        }
    )");
    connect(logoutBtn, &QPushButton::clicked, this, &QMainWindow::close);
    
    QVBoxLayout *bottomLayout = new QVBoxLayout(bottomSection);
    bottomLayout->setContentsMargins(0, 0, 0, 0);
    bottomLayout->addWidget(logoutBtn);
    
    sidebarLayout->addWidget(bottomSection);
    
    // –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞
    QMenu *statusMenu = new QMenu(this);
    statusMenu->setStyleSheet(R"(
        QMenu {
            background-color: #1A1A21;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 5px;
        }
        QMenu::item {
            background-color: transparent;
            color: rgba(255, 255, 255, 0.8);
            padding: 8px 25px;
            border-radius: 4px;
            margin: 2px;
            font-size: 14px;
            min-height: 30px;
        }
        QMenu::item:selected {
            background-color: rgba(138, 43, 226, 0.3);
            color: #8A2BE2;
        }
    )");
    
    QAction *onlineAction = new QAction("–û–Ω–ª–∞–π–Ω", this);
    QAction *awayAction = new QAction("–ù–µ—Ç –Ω–∞ –º–µ—Å—Ç–µ", this);
    QAction *dndAction = new QAction("–ù–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å", this);
    QAction *invisibleAction = new QAction("–ù–µ–≤–∏–¥–∏–º–∫–∞", this);
    
    statusMenu->addAction(onlineAction);
    statusMenu->addAction(awayAction);
    statusMenu->addAction(dndAction);
    statusMenu->addAction(invisibleAction);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–µ–Ω—é –¥–ª—è –∫–Ω–æ–ø–∫–∏
    statusButton->setMenu(statusMenu);
    statusButton->setPopupMode(QToolButton::InstantPopup);
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
    connect(onlineAction, &QAction::triggered, [statusButton]() {
        statusButton->setText("–û–Ω–ª–∞–π–Ω");
        statusButton->setStyleSheet(R"(
            QToolButton {
                color: #4CAF50;
                font-size: 14px;
                font-weight: 500;
                background: transparent;
                border: 1px solid rgba(76, 175, 80, 0.3);
                border-radius: 12px;
                padding: 6px 15px;
                margin: 0 70px;
            }
            QToolButton:hover {
                background: rgba(76, 175, 80, 0.1);
            }
            QToolButton::menu-indicator {
                width: 0px;
            }
        )");
    });
    
    connect(awayAction, &QAction::triggered, [statusButton]() {
        statusButton->setText("–ù–µ—Ç –Ω–∞ –º–µ—Å—Ç–µ");
        statusButton->setStyleSheet(R"(
            QToolButton {
                color: #FFC107;
                font-size: 14px;
                font-weight: 500;
                background: transparent;
                border: 1px solid rgba(255, 193, 7, 0.3);
                border-radius: 12px;
                padding: 6px 15px;
                margin: 0 70px;
            }
            QToolButton:hover {
                background: rgba(255, 193, 7, 0.1);
            }
            QToolButton::menu-indicator {
                width: 0px;
            }
        )");
    });
    
    connect(dndAction, &QAction::triggered, [statusButton]() {
        statusButton->setText("–ù–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å");
        statusButton->setStyleSheet(R"(
            QToolButton {
                color: #F44336;
                font-size: 14px;
                font-weight: 500;
                background: transparent;
                border: 1px solid rgba(244, 67, 54, 0.3);
                border-radius: 12px;
                padding: 6px 15px;
                margin: 0 70px;
            }
            QToolButton:hover {
                background: rgba(244, 67, 54, 0.1);
            }
            QToolButton::menu-indicator {
                width: 0px;
            }
        )");
    });
    
    connect(invisibleAction, &QAction::triggered, [statusButton]() {
        statusButton->setText("–ù–µ–≤–∏–¥–∏–º–∫–∞");
        statusButton->setStyleSheet(R"(
            QToolButton {
                color: #9E9E9E;
                font-size: 14px;
                font-weight: 500;
                background: transparent;
                border: 1px solid rgba(158, 158, 158, 0.3);
                border-radius: 12px;
                padding: 6px 15px;
                margin: 0 70px;
            }
            QToolButton:hover {
                background: rgba(158, 158, 158, 0.1);
            }
            QToolButton::menu-indicator {
                width: 0px;
            }
        )");
    });
}

void MainWindow::createRoomsPage()
{
    roomsPage = new QWidget();
    roomsPage->setObjectName("roomsPage");
    roomsPage->setStyleSheet(R"(
        #roomsPage {
            background: #0F0F14;
        }
    )");
    
    // –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
    QVBoxLayout *mainLayout = new QVBoxLayout(roomsPage);
    mainLayout->setContentsMargins(30, 30, 30, 30);
    mainLayout->setSpacing(25);
    
    // =========== HEADER ===========
    QWidget *headerWidget = new QWidget();
    headerWidget->setStyleSheet("background: transparent;");
    QVBoxLayout *headerLayout = new QVBoxLayout(headerWidget);
    headerLayout->setContentsMargins(0, 0, 0, 0);
    headerLayout->setSpacing(10);
    
    QLabel *titleLabel = new QLabel("–ö–æ–º–Ω–∞—Ç—ã");
    titleLabel->setStyleSheet(R"(
        QLabel {
            color: #FFFFFF;
            font-size: 28px;
            font-weight: 700;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }
    )");
    
    QLabel *subtitleLabel = new QLabel("–°–æ–≤–º–µ—Å—Ç–Ω–æ–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –º—É–∑—ã–∫–∏");
    subtitleLabel->setStyleSheet(R"(
        QLabel {
            color: rgba(255, 255, 255, 0.6);
            font-size: 15px;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }
    )");
    
    headerLayout->addWidget(titleLabel);
    headerLayout->addWidget(subtitleLabel);
    mainLayout->addWidget(headerWidget);
    
    // =========== CONTROLS ===========
    QWidget *controlsWidget = new QWidget();
    controlsWidget->setStyleSheet("background: transparent;");
    QHBoxLayout *controlsLayout = new QHBoxLayout(controlsWidget);
    controlsLayout->setContentsMargins(0, 0, 0, 0);
    controlsLayout->setSpacing(15);
    
    QLineEdit *searchInput = new QLineEdit();
    searchInput->setPlaceholderText("–ü–æ–∏—Å–∫ –∫–æ–º–Ω–∞—Ç...");
    searchInput->setMinimumHeight(45);
    searchInput->setStyleSheet(R"(
        QLineEdit {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 0 20px;
            color: white;
            font-size: 14px;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }
        QLineEdit:focus {
            border: 1px solid #8A2BE2;
        }
    )");
    
    QPushButton *createRoomBtn = new QPushButton("–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É");
    createRoomBtn->setMinimumHeight(45);
    createRoomBtn->setMinimumWidth(160);
    createRoomBtn->setStyleSheet(R"(
        QPushButton {
            background: #8A2BE2;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            font-family: 'Segoe UI', 'Arial', sans-serif;
            padding: 0 25px;
        }
        QPushButton:hover {
            background: #9B4BFF;
        }
    )");
    
    controlsLayout->addWidget(searchInput, 1);
    controlsLayout->addWidget(createRoomBtn);
    mainLayout->addWidget(controlsWidget);
    
    // =========== SEPARATOR ===========
    QFrame *separator = new QFrame();
    separator->setFrameShape(QFrame::HLine);
    separator->setStyleSheet("border: 1px solid rgba(255, 255, 255, 0.05);");
    mainLayout->addWidget(separator);
    
    // =========== ROOMS GRID ===========
    // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π
    QScrollArea *scrollArea = new QScrollArea();
    scrollArea->setWidgetResizable(true);
    scrollArea->setHorizontalScrollBarPolicy(Qt::ScrollBarAlwaysOff);
    scrollArea->setStyleSheet(R"(
        QScrollArea {
            background: transparent;
            border: none;
        }
        QScrollBar:vertical {
            background: rgba(255, 255, 255, 0.05);
            width: 6px;
            border-radius: 3px;
        }
        QScrollBar::handle:vertical {
            background: rgba(138, 43, 226, 0.3);
            border-radius: 3px;
            min-height: 20px;
        }
    )");
    
    QWidget *scrollContent = new QWidget();
    scrollContent->setStyleSheet("background: transparent;");
    
    QGridLayout *roomsGrid = new QGridLayout(scrollContent);
    roomsGrid->setSpacing(20);
    roomsGrid->setContentsMargins(0, 10, 0, 10);
    
    // –î–∞–Ω–Ω—ã–µ –∫–æ–º–Ω–∞—Ç
    struct RoomData {
        QString name;
        QString icon;
        QString details;
        QString currentSong;
        int users;
        int maxUsers;
    };
    
    QVector<RoomData> rooms = {
        {"–í–µ—á–µ—Ä–Ω–∏–π –ª–æ—Ñ—Ç–∏", "üéµ", "–î–∂–∞–∑ ‚Ä¢ –°–æ—É–ª", "Frank Sinatra - Fly Me To The Moon", 4, 10},
        {"–†–µ—Ç—Ä–æ –≤–æ–ª–Ω–∞", "üéµ", "80s ‚Ä¢ –î–∏—Å–∫–æ", "Michael Jackson - Billie Jean", 6, 12},
        {"–ò–Ω–¥–∏-—Å–æ–±—Ä–∞–Ω–∏–µ", "üéµ", "–ò–Ω–¥–∏-—Ä–æ–∫", "Arctic Monkeys - Do I Wanna Know?", 3, 8},
        {"–•–∏–ø-—Ö–æ–ø –ª–∞—É–Ω–∂", "üéµ", "–†—ç–ø ‚Ä¢ –•–∏–ø-—Ö–æ–ø", "Kendrick Lamar - HUMBLE.", 8, 15},
        {"–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –≤–µ—á–µ—Ä–∏–Ω–∫–∞", "üéµ", "–¢–µ—Ö–Ω–æ ‚Ä¢ –•–∞—É—Å", "Daft Punk - Around the World", 12, 20},
        {"–ê–∫—É—Å—Ç–∏—á–µ—Å–∫–∞—è –≥–æ—Å—Ç–∏–Ω–∞—è", "üéµ", "–§–æ–ª–∫ ‚Ä¢ –ê–∫—É—Å—Ç–∏–∫–∞", "Ed Sheeran - Perfect", 2, 6}
    };
    
    for (int i = 0; i < rooms.size(); ++i) {
        const RoomData &room = rooms[i];
        
        // –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–º–Ω–∞—Ç—ã
        QWidget *roomCard = new QWidget();
        roomCard->setFixedHeight(160);
        
        // –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏
        QVBoxLayout *cardLayout = new QVBoxLayout(roomCard);
        cardLayout->setContentsMargins(20, 15, 20, 15);
        cardLayout->setSpacing(10);
        
        // –í–µ—Ä—Ö–Ω—è—è —Å—Ç—Ä–æ–∫–∞: –Ω–∞–∑–≤–∞–Ω–∏–µ + –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
        QWidget *topRow = new QWidget();
        QHBoxLayout *topRowLayout = new QHBoxLayout(topRow);
        topRowLayout->setContentsMargins(0, 0, 0, 0);
        topRowLayout->setSpacing(10);
        
        QLabel *iconLabel = new QLabel(room.icon);
        iconLabel->setStyleSheet(R"(
            QLabel {
                color: #8A2BE2;
                font-size: 16px;
            }
        )");
        
        QLabel *nameLabel = new QLabel(room.name);
        nameLabel->setStyleSheet(R"(
            QLabel {
                color: #FFFFFF;
                font-size: 16px;
                font-weight: 600;
                font-family: 'Segoe UI', 'Arial', sans-serif;
            }
        )");
        nameLabel->setWordWrap(true);
        
        QLabel *usersLabel = new QLabel(QString("%1/%2").arg(room.users).arg(room.maxUsers));
        usersLabel->setStyleSheet(R"(
            QLabel {
                color: rgba(255, 255, 255, 0.7);
                font-size: 13px;
                background: rgba(255, 255, 255, 0.05);
                padding: 4px 10px;
                border-radius: 10px;
                font-family: 'Segoe UI', 'Arial', sans-serif;
            }
        )");
        usersLabel->setAlignment(Qt::AlignCenter);
        
        topRowLayout->addWidget(iconLabel);
        topRowLayout->addWidget(nameLabel, 1);
        topRowLayout->addWidget(usersLabel);
        
        // –î–µ—Ç–∞–ª–∏ –∫–æ–º–Ω–∞—Ç—ã
        QLabel *detailsLabel = new QLabel(room.details);
        detailsLabel->setStyleSheet(R"(
            QLabel {
                color: #8A2BE2;
                font-size: 14px;
                font-weight: 500;
                font-family: 'Segoe UI', 'Arial', sans-serif;
            }
        )");
        
        // –¢–µ–∫—É—â–∏–π —Ç—Ä–µ–∫
        QLabel *songLabel = new QLabel(room.currentSong);
        songLabel->setStyleSheet(R"(
            QLabel {
                color: rgba(255, 255, 255, 0.7);
                font-size: 13px;
                font-style: italic;
                font-family: 'Segoe UI', 'Arial', sans-serif;
            }
        )");
        songLabel->setWordWrap(true);
        songLabel->setMaximumHeight(34);
        
        // –ö–Ω–æ–ø–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
        QPushButton *joinBtn = new QPushButton("–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è");
        joinBtn->setFixedHeight(35);
        joinBtn->setStyleSheet(R"(
            QPushButton {
                background: rgba(138, 43, 226, 0.2);
                border: 1px solid #8A2BE2;
                color: #8A2BE2;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 600;
                font-family: 'Segoe UI', 'Arial', sans-serif;
            }
            QPushButton:hover {
                background: rgba(138, 43, 226, 0.3);
            }
        )");
        joinBtn->setSizePolicy(QSizePolicy::Preferred, QSizePolicy::Fixed);
        
        // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –∫–∞—Ä—Ç–æ—á–∫—É
        cardLayout->addWidget(topRow);
        cardLayout->addWidget(detailsLabel);
        cardLayout->addWidget(songLabel, 1);
        cardLayout->addWidget(joinBtn);
        
        // –°—Ç–∏–ª—å –∫–∞—Ä—Ç–æ—á–∫–∏
        roomCard->setStyleSheet(R"(
            QWidget {
                background: rgba(255, 255, 255, 0.03);
                border: 1px solid rgba(255, 255, 255, 0.05);
                border-radius: 12px;
            }
            QWidget:hover {
                background: rgba(255, 255, 255, 0.05);
                border: 1px solid rgba(138, 43, 226, 0.3);
            }
        )");
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–µ—Ç–∫—É (2 –∫–æ–ª–æ–Ω–∫–∏)
        int row = i / 2;
        int col = i % 2;
        roomsGrid->addWidget(roomCard, row, col, 1, 1);
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞—Å—Ç—è–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
        roomsGrid->setColumnStretch(col, 1);
        roomsGrid->setRowStretch(row, 0);
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º stretch –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
    int totalRows = (rooms.size() + 1) / 2;
    for (int i = totalRows; i < 10; ++i) {
        roomsGrid->setRowStretch(i, 1);
    }
    
    scrollArea->setWidget(scrollContent);
    mainLayout->addWidget(scrollArea, 1);
    
    // =========== ACTIVE ROOM ===========
    QWidget *activeRoomWidget = new QWidget();
    activeRoomWidget->setStyleSheet(R"(
        QWidget {
            background: rgba(138, 43, 226, 0.1);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 12px;
            padding: 20px;
        }
    )");
    
    QHBoxLayout *activeLayout = new QHBoxLayout(activeRoomWidget);
    activeLayout->setContentsMargins(0, 0, 0, 0);
    activeLayout->setSpacing(20);
    
    QLabel *activeIcon = new QLabel("üéß");
    activeIcon->setStyleSheet("font-size: 24px;");
    
    QWidget *infoWidget = new QWidget();
    QVBoxLayout *infoLayout = new QVBoxLayout(infoWidget);
    infoLayout->setContentsMargins(0, 0, 0, 0);
    infoLayout->setSpacing(5);
    
    QLabel *activeTitle = new QLabel("–î–∂–∞–∑ –≤–µ—á–µ—Ä");
    activeTitle->setStyleSheet(R"(
        QLabel {
            color: #FFFFFF;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }
    )");
    
    QLabel *activeDetails = new QLabel("3 —É—á–∞—Å—Ç–Ω–∏–∫–∞ ‚Ä¢ Frank Sinatra - Fly Me To The Moon");
    activeDetails->setStyleSheet(R"(
        QLabel {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }
    )");
    
    infoLayout->addWidget(activeTitle);
    infoLayout->addWidget(activeDetails);
    
    QPushButton *enterBtn = new QPushButton("–í–æ–π—Ç–∏");
    enterBtn->setFixedWidth(100);
    enterBtn->setFixedHeight(40);
    enterBtn->setStyleSheet(R"(
        QPushButton {
            background: #8A2BE2;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }
        QPushButton:hover {
            background: #9B4BFF;
        }
    )");
    
    activeLayout->addWidget(activeIcon);
    activeLayout->addWidget(infoWidget, 1);
    activeLayout->addWidget(enterBtn);
    
    mainLayout->addWidget(activeRoomWidget);
}

void MainWindow::createPages()
{
    mainStack = new QStackedWidget();
    mainStack->setStyleSheet(R"(
        QStackedWidget {
            background: #0F0F14;
        }
    )");
    
    // 1. –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º –í–°–ï —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    createMyMusicPage();    // –°—Ç—Ä–∞–Ω–∏—Ü–∞ 0
    createMusicPage();      // –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1
    createRoomsPage();      // –°—Ç—Ä–∞–Ω–∏—Ü–∞ 2
    
    // 2. –ü—Ä–æ—Å—Ç—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    auto createSimplePage = [](const QString& title) -> QWidget* {
        QWidget *page = new QWidget();
        QVBoxLayout *layout = new QVBoxLayout(page);
        layout->setContentsMargins(40, 40, 40, 40);
        
        QLabel *titleLabel = new QLabel(title);
        titleLabel->setStyleSheet(R"(
            QLabel {
                color: #FFFFFF;
                font-size: 32px;
                font-weight: bold;
                text-align: center;
                margin-bottom: 20px;
            }
        )");
        
        QLabel *descLabel = new QLabel("–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ");
        descLabel->setStyleSheet(R"(
            QLabel {
                color: rgba(255, 255, 255, 0.5);
                font-size: 16px;
                text-align: center;
            }
        )");
        
        layout->addStretch();
        layout->addWidget(titleLabel);
        layout->addWidget(descLabel);
        layout->addStretch();
        
        return page;
    };
    
    profilePage = createSimplePage("–ü—Ä–æ—Ñ–∏–ª—å");
    messagesPage = createSimplePage("–°–æ–æ–±—â–µ–Ω–∏—è");
    friendsPage = createSimplePage("–î—Ä—É–∑—å—è");
    notificationsPage = createSimplePage("–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è");
    playlistPage = createSimplePage("–ú–æ–∏ –ø–ª–µ–π–ª–∏—Å—Ç—ã");
    
    // 3. –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –¥–æ–±–∞–≤–ª—è–µ–º –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ!
    // –ü–æ—Ä—è–¥–æ–∫ –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å enum PageIndex
    mainStack->addWidget(myMusicPage);      // 0: MY_MUSIC_PAGE
    mainStack->addWidget(profilePage);      // 1: PROFILE_PAGE
    mainStack->addWidget(messagesPage);     // 2: MESSAGES_PAGE
    mainStack->addWidget(friendsPage);      // 3: FRIENDS_PAGE
    mainStack->addWidget(notificationsPage); // 4: NOTIFICATIONS_PAGE
    mainStack->addWidget(playlistPage);     // 5: PLAYLIST_PAGE
    mainStack->addWidget(musicPage);        // 6: MUSIC_PAGE
    mainStack->addWidget(roomsPage);        // 7: ROOMS_PAGE
    
    // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
    qDebug() << "–°–æ–∑–¥–∞–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü –≤ mainStack:" << mainStack->count();
}

void MainWindow::createMyMusicPage()
{
    myMusicPage = new QWidget();
    myMusicPage->setObjectName("myMusicPage");
    myMusicPage->setStyleSheet(R"(
        #myMusicPage {
            background: #0F0F14;
        }
    )");
    
    QVBoxLayout *myMusicLayout = new QVBoxLayout(myMusicPage);
    myMusicLayout->setContentsMargins(40, 40, 40, 40);
    myMusicLayout->setSpacing(25);
    
    QLabel *myMusicTitle = new QLabel("–ú–æ—è –º—É–∑—ã–∫–∞");
    myMusicTitle->setStyleSheet(R"(
        QLabel {
            color: #FFFFFF;
            font-size: 32px;
            font-weight: bold;
        }
    )");
    
    // –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    QWidget *controlsWidget = new QWidget();
    controlsWidget->setStyleSheet("background: transparent;");
    QHBoxLayout *controlsLayout = new QHBoxLayout(controlsWidget);
    controlsLayout->setContentsMargins(0, 0, 0, 0);
    
    refreshTracksBtn = new QPushButton("–û–±–Ω–æ–≤–∏—Ç—å");
    addLocalTrackBtn = new QPushButton("–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫");
    
    QString controlButtonStyle = R"(
        QPushButton {
            background: rgba(138, 43, 226, 0.2);
            border: 1px solid #8A2BE2;
            color: #8A2BE2;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        QPushButton:hover {
            background: rgba(138, 43, 226, 0.3);
            transform: translateY(-1px);
        }
        QPushButton:pressed {
            transform: translateY(0px);
            background: rgba(138, 43, 226, 0.4);
        }
    )";
    
    refreshTracksBtn->setStyleSheet(controlButtonStyle);
    addLocalTrackBtn->setStyleSheet(controlButtonStyle);
    
    controlsLayout->addWidget(refreshTracksBtn);
    controlsLayout->addWidget(addLocalTrackBtn);
    controlsLayout->addStretch();
    
    // –°–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤
    userTracksList = new QListWidget();
    userTracksList->setStyleSheet(R"(
        QListWidget {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            color: white;
            font-size: 14px;
            outline: none;
            padding: 5px;
        }
        QListWidget::item {
            background: transparent;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            height: 60px;
            border-radius: 8px;
            margin: 2px;
        }
        QListWidget::item:selected {
            background: rgba(138, 43, 226, 0.15);
            color: white;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }
        QListWidget::item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
    )");
    
    myMusicLayout->addWidget(myMusicTitle);
    myMusicLayout->addWidget(controlsWidget);
    myMusicLayout->addWidget(userTracksList, 1);
}

void MainWindow::createMusicPage()
{
    musicPage = new QWidget();
    musicPage->setObjectName("musicPage");
    musicPage->setStyleSheet(R"(
        #musicPage {
            background: #0F0F14;
        }
    )");
    
    QVBoxLayout *mainLayout = new QVBoxLayout(musicPage);
    mainLayout->setContentsMargins(40, 40, 40, 40);
    mainLayout->setSpacing(25);
    
    QLabel *titleLabel = new QLabel("–ü–æ–∏—Å–∫ –º—É–∑—ã–∫–∏");
    titleLabel->setStyleSheet(R"(
        QLabel {
            color: #FFFFFF;
            font-size: 32px;
            font-weight: bold;
        }
    )");
    mainLayout->addWidget(titleLabel);
    
    // –ü–æ–∏—Å–∫–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞
    QWidget *searchWidget = new QWidget();
    searchWidget->setStyleSheet("background: transparent;");
    QHBoxLayout *searchLayout = new QHBoxLayout(searchWidget);
    searchLayout->setContentsMargins(0, 0, 0, 0);
    searchLayout->setSpacing(15);
    
    searchInput = new QLineEdit();
    searchInput->setPlaceholderText("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞, –∞–ª—å–±–æ–º–∞ –∏–ª–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è...");
    searchInput->setMinimumHeight(50);
    searchInput->setStyleSheet(R"(
        QLineEdit {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 0 20px;
            color: white;
            font-size: 14px;
            selection-background-color: #8A2BE2;
        }
        QLineEdit:focus {
            border: 2px solid #8A2BE2;
            background: rgba(255, 255, 255, 0.07);
        }
        QLineEdit::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }
    )");
    
    searchButton = new QPushButton("–ù–∞–π—Ç–∏");
    searchButton->setFixedWidth(120);
    searchButton->setMinimumHeight(50);
    searchButton->setStyleSheet(R"(
        QPushButton {
            background: #8A2BE2;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
        }
        QPushButton:hover {
            background: #9B4BFF;
            transform: translateY(-1px);
        }
        QPushButton:pressed {
            transform: translateY(0px);
            background: #7B1FA2;
        }
    )");
    
    topTracksButton = new QPushButton("üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ");
    topTracksButton->setFixedWidth(150);
    topTracksButton->setMinimumHeight(50);
    topTracksButton->setStyleSheet(searchButton->styleSheet());
    
    searchLayout->addWidget(searchInput, 1);
    searchLayout->addWidget(searchButton);
    searchLayout->addWidget(topTracksButton);
    mainLayout->addWidget(searchWidget);
    
    // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
    QWidget *resultsWidget = new QWidget();
    resultsWidget->setStyleSheet("background: transparent;");
    QHBoxLayout *resultsLayout = new QHBoxLayout(resultsWidget);
    resultsLayout->setContentsMargins(0, 0, 0, 0);
    resultsLayout->setSpacing(20);
    
    // –°–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤
    tracksList = new QListWidget();
    tracksList->setStyleSheet(R"(
        QListWidget {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            color: white;
            font-size: 14px;
            outline: none;
            padding: 10px;
        }
        QListWidget::item {
            background: transparent;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 2px;
        }
        QListWidget::item:selected {
            background: rgba(138, 43, 226, 0.15);
            color: white;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }
        QListWidget::item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
    )");
    
    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–µ–∫–µ
    QWidget *infoWidget = new QWidget();
    infoWidget->setStyleSheet(R"(
        QWidget {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 255, 255, 0.05);
            border-radius: 15px;
        }
    )");
    
    QVBoxLayout *infoLayout = new QVBoxLayout(infoWidget);
    infoLayout->setContentsMargins(25, 25, 25, 25);
    infoLayout->setSpacing(20);
    
    QLabel *infoTitle = new QLabel("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–µ–∫–µ");
    infoTitle->setStyleSheet(R"(
        QLabel {
            color: #FFFFFF;
            font-size: 18px;
            font-weight: 600;
        }
    )");
    
    trackInfo = new QTextEdit();
    trackInfo->setReadOnly(true);
    trackInfo->setStyleSheet(R"(
        QTextEdit {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            padding: 15px;
            selection-background-color: #8A2BE2;
        }
    )");
    trackInfo->setPlaceholderText("–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–∫ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...");
    
    QPushButton *addToLibraryBtn = new QPushButton("‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É");
    addToLibraryBtn->setStyleSheet(R"(
        QPushButton {
            background: rgba(138, 43, 226, 0.2);
            border: 1px solid #8A2BE2;
            color: #8A2BE2;
            border-radius: 8px;
            padding: 12px;
            font-weight: 600;
            font-size: 14px;
        }
        QPushButton:hover {
            background: rgba(138, 43, 226, 0.3);
        }
        QPushButton:pressed {
            background: rgba(138, 43, 226, 0.4);
        }
    )");
    addToLibraryBtn->setVisible(false);
    
    infoLayout->addWidget(infoTitle);
    infoLayout->addWidget(trackInfo, 1);
    infoLayout->addWidget(addToLibraryBtn);
    
    resultsLayout->addWidget(tracksList, 2);
    resultsLayout->addWidget(infoWidget, 1);
    mainLayout->addWidget(resultsWidget, 1);
    
    // –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
    tracksList->setContextMenuPolicy(Qt::CustomContextMenu);
    
    connect(tracksList, &QListWidget::itemClicked, this, [this, addToLibraryBtn](QListWidgetItem *item) {
        trackInfo->setPlainText(item->data(Qt::UserRole).toString());
        addToLibraryBtn->setVisible(true);
        addToLibraryBtn->setProperty("trackData", item->data(Qt::UserRole + 1));
    });
    
    connect(addToLibraryBtn, &QPushButton::clicked, this, [this, addToLibraryBtn]() {
        QVariant trackData = addToLibraryBtn->property("trackData");
        if (trackData.isValid()) {
            QVariantMap track = trackData.toMap();
            
            bool success = DatabaseManager::instance().addTrackFromAPI(
                currentUserId,
                track["title"].toString(),
                track["artist"].toString(),
                track["coverUrl"].toString()
            );
                    
            if (success) {
                QMessageBox::information(this, "–£—Å–ø–µ—Ö", "–¢—Ä–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É!");
                addToLibraryBtn->setVisible(false);
            } else {
                QMessageBox::warning(this, "–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É");
            }
        }
    });
    
    connect(tracksList, &QListWidget::customContextMenuRequested, this, [this](const QPoint &pos) {
        QListWidgetItem *item = tracksList->itemAt(pos);
        if (item) {
            QMenu contextMenu(this);
            contextMenu.setStyleSheet(R"(
                QMenu {
                    background-color: #1A1A21;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    border-radius: 8px;
                    padding: 5px;
                }
                QMenu::item {
                    background-color: transparent;
                    color: rgba(255, 255, 255, 0.8);
                    padding: 8px 20px;
                    border-radius: 4px;
                    margin: 2px;
                }
                QMenu::item:selected {
                    background-color: rgba(138, 43, 226, 0.3);
                    color: #8A2BE2;
                }
                QMenu::separator {
                    height: 1px;
                    background: rgba(255, 255, 255, 0.1);
                    margin: 5px 10px;
                }
            )");
            
            QAction *addToLibraryAction = contextMenu.addAction("‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É");
            QAction *viewInfoAction = contextMenu.addAction("‚ÑπÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é");
            contextMenu.addSeparator();
            QAction *shareAction = contextMenu.addAction("‚ÜóÔ∏è –ü–æ–¥–µ–ª–∏—Ç—å—Å—è");
            
            QAction *selectedAction = contextMenu.exec(tracksList->mapToGlobal(pos));
            
            if (selectedAction == addToLibraryAction) {
                QVariant trackData = item->data(Qt::UserRole + 1);
                if (trackData.isValid()) {
                    QVariantMap track = trackData.toMap();
                    
                    bool success = DatabaseManager::instance().addTrackFromAPI(
                        currentUserId,
                        track["title"].toString(),
                        track["artist"].toString(),
                        track["coverUrl"].toString()
                    );
                    
                    if (success) {
                        QMessageBox::information(this, "–£—Å–ø–µ—Ö", "–¢—Ä–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É!");
                    }
                }
            } else if (selectedAction == viewInfoAction) {
                trackInfo->setPlainText(item->data(Qt::UserRole).toString());
            }
        }
    });
}

void MainWindow::showRoomsPage()
{
    mainStack->setCurrentIndex(ROOMS_PAGE);
}

void MainWindow::setupConnections()
{
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ä—è–¥–æ–∫ —Å enum
    qDebug() << "MY_MUSIC_PAGE –∏–Ω–¥–µ–∫—Å:" << MY_MUSIC_PAGE;
    qDebug() << "ROOMS_PAGE –∏–Ω–¥–µ–∫—Å:" << ROOMS_PAGE;
    
    // 2. –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    connect(myMusicBtn, &QPushButton::clicked, this, [this]() { 
        qDebug() << "–ù–∞–∂–∞—Ç–∞ –ú–æ—è –º—É–∑—ã–∫–∞, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ –∏–Ω–¥–µ–∫—Å" << MY_MUSIC_PAGE;
        mainStack->setCurrentIndex(MY_MUSIC_PAGE); 
        loadUserTracks();
    });
    
    connect(profileBtn, &QPushButton::clicked, this, [this]() { 
        mainStack->setCurrentIndex(PROFILE_PAGE); 
    });
    
    connect(messagesBtn, &QPushButton::clicked, this, [this]() { 
        mainStack->setCurrentIndex(MESSAGES_PAGE); 
    });
    
    connect(friendsBtn, &QPushButton::clicked, this, [this]() { 
        mainStack->setCurrentIndex(FRIENDS_PAGE); 
    });
    
    connect(notificationsBtn, &QPushButton::clicked, this, [this]() { 
        mainStack->setCurrentIndex(NOTIFICATIONS_PAGE); 
    });
    
    connect(playlistBtn, &QPushButton::clicked, this, [this]() { 
        mainStack->setCurrentIndex(PLAYLIST_PAGE); 
    });
    
    connect(musicSearchBtn, &QPushButton::clicked, this, [this]() { 
        qDebug() << "–ù–∞–∂–∞—Ç–∞ –ü–æ–∏—Å–∫ –º—É–∑—ã–∫–∏, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ –∏–Ω–¥–µ–∫—Å" << MUSIC_PAGE;
        mainStack->setCurrentIndex(MUSIC_PAGE); 
    });
    
    connect(roomsBtn, &QPushButton::clicked, this, [this]() { 
        qDebug() << "–ù–∞–∂–∞—Ç–∞ –ö–æ–º–Ω–∞—Ç—ã, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ –∏–Ω–¥–µ–∫—Å" << ROOMS_PAGE;
        mainStack->setCurrentIndex(ROOMS_PAGE); 
    });
    
    // –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å
    connect(avatarButton, &QPushButton::clicked, this, &MainWindow::changeAvatar);
    connect(searchButton, &QPushButton::clicked, this, &MainWindow::searchMusic);
    connect(topTracksButton, &QPushButton::clicked, this, &MainWindow::showTopTracks);
    connect(searchInput, &QLineEdit::returnPressed, this, &MainWindow::searchMusic);
    connect(apiManager, &MusicAPIManager::tracksFound, this, &MainWindow::onTracksFound);
    connect(apiManager, &MusicAPIManager::errorOccurred, this, &MainWindow::onNetworkError);
    connect(refreshTracksBtn, &QPushButton::clicked, this, &MainWindow::loadUserTracks);
    connect(addLocalTrackBtn, &QPushButton::clicked, this, [this]() {
        QString filePath = QFileDialog::getOpenFileName(this, "–í—ã–±–µ—Ä–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª", QDir::homePath(), 
                                                       "Audio Files (*.mp3 *.wav *.flac *.ogg *.m4a)");
        if (!filePath.isEmpty()) {
            QMessageBox::information(this, "–£—Å–ø–µ—Ö", "–¢—Ä–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É!");
            loadUserTracks();
        }
    });
    connect(userTracksList, &QListWidget::itemClicked, this, &MainWindow::onPlaylistItemClicked);
}

void MainWindow::playTrack(int trackId)
{
    for (int i = 0; i < currentTracks.size(); ++i) {
        if (currentTracks[i].id == trackId) {
            currentTrackIndex = i;
            Track track = currentTracks[i];
            
            audioPlayer->updateTrackInfo(track.title, track.artist);
            
            if (track.filePath.startsWith("lastfm://")) {
                QMessageBox::information(this, "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", 
                    QString("–¢—Ä–µ–∫ '%1 - %2' –∏–∑ –æ–Ω–ª–∞–π–Ω-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Last.fm.\n\n"
                           "–î–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –æ–Ω–ª–∞–π–Ω-—Ç—Ä–µ–∫–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:\n"
                           "1. –ü–æ–ª—É—á–∏—Ç—å URL –ø–æ—Ç–æ–∫–∞ –∏–∑ Last.fm API\n"
                           "2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–Ω–ª–∞–π–Ω-–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ").arg(track.artist).arg(track.title));
                return;
            }
            
            if (QFile::exists(track.filePath)) {
                audioPlayer->playTrack(track.filePath);
                DatabaseManager::instance().incrementPlayCount(trackId);
            } else {
                QMessageBox::warning(this, "–û—à–∏–±–∫–∞", "–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: " + track.filePath);
            }
            break;
        }
    }
}

void MainWindow::onPlaylistItemClicked(QListWidgetItem *item)
{
    if (item) {
        int trackId = item->data(Qt::UserRole).toInt();
        playTrack(trackId);
    }
}

void MainWindow::onTrackDeleteRequested(int trackId)
{
    QMessageBox msgBox;
    msgBox.setWindowTitle("–£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞");
    msgBox.setText("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç—Ä–µ–∫ –∏–∑ —Å–≤–æ–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏?");
    msgBox.setStyleSheet(R"(
        QMessageBox {
            background-color: #1A1A21;
            color: white;
        }
        QMessageBox QLabel {
            color: white;
        }
        QMessageBox QPushButton {
            background-color: #8A2BE2;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
        }
        QMessageBox QPushButton:hover {
            background-color: #9B4BFF;
        }
        QMessageBox QPushButton#NoButton {
            background-color: rgba(255, 255, 255, 0.1);
        }
    )");
    msgBox.setStandardButtons(QMessageBox::Yes | QMessageBox::No);
    msgBox.setDefaultButton(QMessageBox::No);
    
    if (msgBox.exec() == QMessageBox::Yes) {
        bool success = DatabaseManager::instance().deleteTrack(trackId);
        
        if (success) {
            QMessageBox::information(this, "–£—Å–ø–µ—Ö", "–¢—Ä–µ–∫ —É–¥–∞–ª–µ–Ω –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏!");
            loadUserTracks();
        } else {
            QMessageBox::warning(this, "–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ç—Ä–µ–∫");
        }
    }
}

void MainWindow::loadUserTracks()
{
    userTracksList->clear();
    currentTracks = DatabaseManager::instance().getUserTracks(currentUserId);
    
    for (const Track &track : currentTracks) {
        QString duration = track.duration > 0 ? audioPlayer->formatTime(track.duration) : "0:00";
        QString itemText = QString("%1 - %2 (%3)").arg(track.artist).arg(track.title).arg(duration);
        
        TrackListWidgetItem *item = new TrackListWidgetItem("", track.id, userTracksList);
        item->setData(Qt::UserRole, track.id);
        item->setSizeHint(QSize(item->sizeHint().width(), 60));
        
        QWidget *itemWidget = new QWidget();
        QHBoxLayout *itemLayout = new QHBoxLayout(itemWidget);
        itemLayout->setContentsMargins(15, 10, 15, 10);
        itemLayout->setSpacing(15);
        
        QLabel *trackIcon = new QLabel("üéµ");
        trackIcon->setStyleSheet("font-size: 16px;");
        
        QWidget *textWidget = new QWidget();
        QVBoxLayout *textLayout = new QVBoxLayout(textWidget);
        textLayout->setContentsMargins(0, 0, 0, 0);
        textLayout->setSpacing(3);
        
        QLabel *titleLabel = new QLabel(track.title);
        titleLabel->setStyleSheet(R"(
            QLabel {
                color: white;
                font-size: 14px;
                font-weight: 500;
                background-color: transparent;
            }
        )");
        
        QLabel *artistLabel = new QLabel(track.artist);
        artistLabel->setStyleSheet(R"(
            QLabel {
                color: rgba(255, 255, 255, 0.6);
                font-size: 12px;
                background-color: transparent;
            }
        )");
        
        textLayout->addWidget(titleLabel);
        textLayout->addWidget(artistLabel);
        
        QLabel *durationLabel = new QLabel(duration);
        durationLabel->setStyleSheet(R"(
            QLabel {
                color: rgba(255, 255, 255, 0.5);
                font-size: 12px;
                min-width: 40px;
            }
        )");
        
        QPushButton *playBtn = new QPushButton("‚ñ∂");
        playBtn->setFixedSize(35, 35);
        playBtn->setStyleSheet(R"(
            QPushButton {
                background-color: rgba(138, 43, 226, 0.2);
                color: #8A2BE2;
                border: none;
                border-radius: 17px;
                font-size: 12px;
                font-weight: bold;
            }
            QPushButton:hover {
                background-color: rgba(138, 43, 226, 0.3);
                color: white;
            }
        )");
        
        QPushButton *deleteBtn = new QPushButton("√ó");
        deleteBtn->setFixedSize(25, 25);
        deleteBtn->setStyleSheet(R"(
            QPushButton {
                background-color: rgba(255, 68, 68, 0.1);
                color: rgba(255, 68, 68, 0.7);
                border: 1px solid rgba(255, 68, 68, 0.3);
                border-radius: 4px;
                font-size: 12px;
                font-weight: bold;
            }
            QPushButton:hover {
                background-color: rgba(255, 68, 68, 0.2);
                color: #FF4444;
            }
        )");
        
        // –ó–ê–•–í–ê–¢–´–í–ê–ï–ú trackId –ö–ê–ö –õ–û–ö–ê–õ–¨–ù–£–Æ –ö–û–ü–ò–Æ
        int trackId = track.id;  // –°–æ–∑–¥–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –∫–æ–ø–∏—é
        
        connect(playBtn, &QPushButton::clicked, [this, trackId]() {
            playTrack(trackId);
        });
        
        connect(deleteBtn, &QPushButton::clicked, this, [this, trackId]() {
            onTrackDeleteRequested(trackId);
        });
        
        itemLayout->addWidget(trackIcon);
        itemLayout->addWidget(textWidget, 1);
        itemLayout->addWidget(durationLabel);
        itemLayout->addWidget(playBtn);
        itemLayout->addWidget(deleteBtn);
        
        itemWidget->setLayout(itemLayout);
        itemWidget->setStyleSheet("QWidget { background-color: transparent; }");
        
        userTracksList->setItemWidget(item, itemWidget);
    }
}


void MainWindow::setupAvatar()
{
  setDefaultAvatar();
}

void MainWindow::setAvatarPixmap(const QPixmap& pixmap)
{
    // –£–±–µ–¥–∏—Å—å, —á—Ç–æ –∞–≤–∞—Ç–∞—Ä–∫–∞ –∫—Ä—É–≥–ª–∞—è —á–µ—Ä–µ–∑ —Å—Ç–∏–ª–∏, –∞ –Ω–µ –º–∞—Å–∫—É
    QPixmap scaledPixmap = pixmap.scaled(100, 100, Qt::KeepAspectRatioByExpanding, Qt::SmoothTransformation);
    
    // –°–æ–∑–¥–∞–µ–º –∫—Ä—É–≥–ª—É—é –∏–∫–æ–Ω–∫—É
    QPixmap circularPixmap(100, 100);
    circularPixmap.fill(Qt::transparent);
    
    QPainter painter(&circularPixmap);
    painter.setRenderHint(QPainter::Antialiasing, true);
    painter.setRenderHint(QPainter::SmoothPixmapTransform, true);
    
    QPainterPath path;
    path.addEllipse(0, 0, 100, 100);
    painter.setClipPath(path);
    
    // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º
    int x = (100 - scaledPixmap.width()) / 2;
    int y = (100 - scaledPixmap.height()) / 2;
    painter.drawPixmap(x, y, scaledPixmap);
    
    avatarButton->setIcon(QIcon(circularPixmap));
    avatarButton->setIconSize(QSize(100, 100));
    avatarButton->setText("");
}

void MainWindow::setDefaultAvatar()
{
    QPixmap defaultPixmap(100, 100);
    defaultPixmap.fill(Qt::transparent);
    
    QPainter painter(&defaultPixmap);
    painter.setRenderHint(QPainter::Antialiasing, true);
    
    // –ö—Ä—É–≥–ª—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
    QPainterPath circlePath;
    circlePath.addEllipse(0, 0, 100, 100);
    painter.setClipPath(circlePath);
    
    QRadialGradient gradient(50, 50, 50);
    gradient.setColorAt(0, QColor("#9B4BFF"));
    gradient.setColorAt(1, QColor("#7B1FA2"));
    
    painter.setBrush(QBrush(gradient));
    painter.setPen(Qt::NoPen);
    painter.drawEllipse(0, 0, 100, 100);
    
    // –ò–Ω–∏—Ü–∏–∞–ª—ã
    painter.setPen(QPen(Qt::white, 2));
    painter.setFont(QFont("Arial", 24, QFont::Bold));
    
    QString initials = currentUsername.left(2).toUpper();
    painter.drawText(QRect(0, 0, 100, 100), Qt::AlignCenter, initials);
    
    avatarButton->setIcon(QIcon(defaultPixmap));
    avatarButton->setIconSize(QSize(100, 100));
    avatarButton->setText("");
}

void MainWindow::changeAvatar()
{
    QString filePath = QFileDialog::getOpenFileName(
        this,
        "–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∫–∏",
        QDir::homePath(),
        "Images (*.png *.jpg *.jpeg *.bmp *.gif)"
    );
    
    if (!filePath.isEmpty()) {
        QPixmap newAvatar(filePath);
        if (newAvatar.isNull()) {
            QMessageBox::warning(this, "–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ");
            return;
        }
        
        saveAvatar(newAvatar);
        setAvatarPixmap(newAvatar);
        
        QMessageBox::information(this, "–£—Å–ø–µ—Ö", "–ê–≤–∞—Ç–∞—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∞!");
    }
}

void MainWindow::saveAvatar(const QPixmap& avatar)
{
    QDir dir("avatars");
    if (!dir.exists()) {
        dir.mkpath(".");
    }
    
    QString filePath = QString("avatars/user_%1.png").arg(currentUserId);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å –ª—É—á—à–∏–º –∫–∞—á–µ—Å—Ç–≤–æ–º
    if (!avatar.save(filePath, "PNG", 100)) {
        qDebug() << "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä:" << filePath;
    } else {
        qDebug() << "–ê–≤–∞—Ç–∞—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω:" << filePath;
    }
}

void MainWindow::loadUserAvatar()
{
    QString userAvatarPath = QString("avatars/user_%1.png").arg(currentUserId);
    QFile avatarFile(userAvatarPath);
    
    if (avatarFile.exists()) {
        QPixmap avatarPixmap(userAvatarPath);
        if (!avatarPixmap.isNull()) {
            setAvatarPixmap(avatarPixmap);
            return;
        }
    }
    
    // –ï—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –∞–≤–∞—Ç–∞—Ä
    setDefaultAvatar();
}

void MainWindow::showProfilePage() { mainStack->setCurrentIndex(PROFILE_PAGE); }
void MainWindow::showMessagesPage() { mainStack->setCurrentIndex(MESSAGES_PAGE); }
void MainWindow::showFriendsPage() { mainStack->setCurrentIndex(FRIENDS_PAGE); }
void MainWindow::showNotificationsPage() { mainStack->setCurrentIndex(NOTIFICATIONS_PAGE); }
void MainWindow::showPlaylistPage() { mainStack->setCurrentIndex(PLAYLIST_PAGE); }

void MainWindow::searchMusic()
{
    qDebug() << "–ó–∞–ø—É—Å–∫ –ø–æ–∏—Å–∫–∞ –º—É–∑—ã–∫–∏...";
    
    QString query = searchInput->text().trimmed();
    if (query.isEmpty()) {
        trackInfo->setPlainText("–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å!");
        return;
    }
    
    tracksList->clear();
    trackInfo->setPlainText("–ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–æ–≤...");
    
    enableSearchControls(false);
    
    QApplication::processEvents();
    
    qDebug() << "–ü–æ–∏—Å–∫ –ø–æ –∑–∞–ø—Ä–æ—Å—É:" << query;
    apiManager->searchTracks(query, currentUserId);
}

void MainWindow::showTopTracks()
{
    tracksList->clear();
    trackInfo->setPlainText("–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤...");
    
    enableSearchControls(false);
    QApplication::processEvents();
    
    qDebug() << "Loading top tracks";
    apiManager->getTopTracks(currentUserId);
}

void MainWindow::onTracksFound(const QVariantList& tracks)
{
    enableSearchControls(true);
    
    tracksList->clear();
    
    if (tracks.isEmpty()) {
        trackInfo->setPlainText("–¢—Ä–µ–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!");
        return;
    }
    
    for (const QVariant &trackVar : tracks) {
        QVariantMap track = trackVar.toMap();
        QString title = track["title"].toString();
        QString artist = track["artist"].toString();
        QString listeners = track.value("listeners", "N/A").toString();
        QString coverUrl = track.value("coverUrl", "").toString();
        
        QString itemText = QString("%1 - %2").arg(title).arg(artist);
        if (listeners != "N/A") {
            itemText += QString(" [%1]").arg(listeners);
        }
        
        QListWidgetItem *item = new QListWidgetItem(itemText, tracksList);
        
        QString trackInfoText = QString(
            "–¢—Ä–µ–∫: %1\n"
            "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: %2\n"
            "–ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π: %3\n"
            "–û–±–ª–æ–∂–∫–∞: %4\n\n"
            "–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É –Ω–∞–∂–º–∏—Ç–µ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏"
        ).arg(title).arg(artist).arg(listeners).arg(coverUrl.isEmpty() ? "–ù–µ—Ç" : "–ï—Å—Ç—å");
        
        item->setData(Qt::UserRole, trackInfoText);
        item->setData(Qt::UserRole + 1, track);
    }
    
    trackInfo->setPlainText(QString("–ù–∞–π–¥–µ–Ω–æ —Ç—Ä–µ–∫–æ–≤: %1\n\n–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–∫ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.").arg(tracks.size()));
}

void MainWindow::onNetworkError(const QString& error)
{
    enableSearchControls(true);
    
    QMessageBox::critical(this, "–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞", 
        QString("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –º—É–∑—ã–∫–∏:\n%1").arg(error));
}

void MainWindow::enableSearchControls(bool enable)
{
    searchButton->setEnabled(enable);
    topTracksButton->setEnabled(enable);
    searchInput->setEnabled(enable);
    
    QString style = enable ? 
        "QPushButton { background: #8A2BE2; }" :
        "QPushButton { background: rgba(138, 43, 226, 0.3); color: rgba(255, 255, 255, 0.5); }";
    
    searchButton->setStyleSheet(style);
    topTracksButton->setStyleSheet(style);
}

=== kursach/src/gui/MainWindow/MainWindow.h ===
#ifndef MAINWINDOW_H
#define MAINWINDOW_H

#include <QMainWindow>
#include <QListWidgetItem>
#include <QProgressDialog>
#include "../Frameless/FramelessWindow.h"

class QStackedWidget;
class QListWidget;
class QPushButton;
class QLabel;
class QLineEdit;
class QTextEdit;
class QProgressDialog;
class MusicAPIManager;
class AudioPlayer;
struct Track;

class MainWindow : public FramelessWindow
{
    Q_OBJECT

public:
    explicit MainWindow(const QString& username, int userId, QWidget *parent = nullptr);
    ~MainWindow();

private slots:
    void showProfilePage();
    void showMessagesPage();
    void showFriendsPage();
    void showNotificationsPage();
    void showPlaylistPage();
    void searchMusic();
    void onTracksFound(const QVariantList& tracks);
    void showTopTracks();
    void changeAvatar();
    void loadUserTracks();
    void playTrack(int trackId);
    void onPlaylistItemClicked(QListWidgetItem *item);
    void onTrackDeleteRequested(int trackId);
    void onNetworkError(const QString& error);
    void showRoomsPage();

protected:
    bool eventFilter(QObject *obj, QEvent *event) override;

private:
    void setupUI();
    void setupConnections();
    void createSidebar();
    void createPages();
    void createMusicPage();
    void createMyMusicPage();
    void createRoomsPage();
    void loadUserAvatar();
    void setupAvatar();
    void setAvatarPixmap(const QPixmap& pixmap);
    void setDefaultAvatar();
    void saveAvatar(const QPixmap& avatar);
    void enableSearchControls(bool enable);
    void showAvatarOverlay();
    void hideAvatarOverlay();
    void onAvatarButtonEnter();
    void onAvatarButtonLeave();

    QString currentUsername;
    int currentUserId;
    
    QWidget *sidebar;
    QPushButton *avatarButton;
    QLabel *avatarOverlay;
    QLabel *usernameLabel;
    QPushButton *profileBtn;
    QPushButton *messagesBtn;
    QPushButton *friendsBtn;
    QPushButton *notificationsBtn;
    QPushButton *playlistBtn;
    QPushButton *musicSearchBtn;
    QPushButton *myMusicBtn;
    QPushButton *roomsBtn;
    
    QStackedWidget *mainStack;
    QWidget *profilePage;
    QWidget *messagesPage;
    QWidget *friendsPage;
    QWidget *notificationsPage;
    QWidget *playlistPage;
    QWidget *musicPage;
    QWidget *myMusicPage;
    QWidget *roomsPage;
    
    QLineEdit *searchInput;
    QPushButton *searchButton;
    QPushButton *topTracksButton;
    QListWidget *tracksList;
    QTextEdit *trackInfo;
    
    QListWidget *userTracksList;
    QPushButton *refreshTracksBtn;
    QPushButton *addLocalTrackBtn;
    
    MusicAPIManager *apiManager;
    AudioPlayer *audioPlayer;
    QLabel *loadingLabel;

    QString avatarPath;
    QList<Track> currentTracks;
    int currentTrackIndex;

    enum PageIndex {
        MY_MUSIC_PAGE = 0,
        PROFILE_PAGE,
        MESSAGES_PAGE,
        FRIENDS_PAGE,
        NOTIFICATIONS_PAGE,
        PLAYLIST_PAGE,
        MUSIC_PAGE,
        ROOMS_PAGE  
    };
};

#endif

=== kursach/src/gui/AuthWindow/AuthWindow.h ===
#ifndef AUTHWINDOW_H
#define AUTHWINDOW_H

#include <QMainWindow>

class QStackedWidget;
class QLineEdit;
class QPushButton;
class QLabel;
class QWidget;

class AuthWindow : public QMainWindow
{
    Q_OBJECT

public:
    AuthWindow(QWidget *parent = nullptr);
    ~AuthWindow();

private slots:
    void onRegisterClicked();
    void onLoginClicked();
    void switchToLogin();
    void switchToRegister();
    void showMainWindow(const QString& username);

protected:
    bool eventFilter(QObject *obj, QEvent *event) override;

private:
    void setupUI();
    void setupConnections();
    void showMessage(const QString& title, const QString& text, bool isError = true);
    void showSqlInjectionError();
    
    bool isValidEmail(const QString& email);
    bool isValidUsername(const QString& username);
    bool isStrongPassword(const QString& password);
    bool hasSqlInjection(const QString& input);
    
    // UI —ç–ª–µ–º–µ–Ω—Ç—ã
    QStackedWidget *stackedWidget;
    QWidget *regPage;
    QLineEdit *regEmail;
    QLineEdit *regUser;
    QLineEdit *regPass;
    QLineEdit *regConfirmPass;
    QPushButton *regBtn;
    QPushButton *toLoginBtn;
    QWidget *loginPage;
    QLineEdit *loginUser;
    QLineEdit *loginPass;
    QPushButton *loginBtn;
    QPushButton *toRegBtn;
    
    // –î–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –æ–∫–Ω–∞
    QWidget *titleBarWidget;
    bool m_dragging;
    QPoint m_dragPosition;
};

#endif

=== kursach/src/gui/AuthWindow/AuthWindow.cpp ===
#include "AuthWindow.h"
#include "../MainWindow/MainWindow.h"
#include "../../database/DatabaseManager.h"

#include <QVBoxLayout>
#include <QHBoxLayout>
#include <QFormLayout>
#include <QMessageBox>
#include <QDebug>
#include <QStackedWidget>
#include <QLineEdit>
#include <QPushButton>
#include <QLabel>
#include <QStatusBar>
#include <QRegularExpression>
#include <QDialog>
#include <QGraphicsDropShadowEffect>
#include <QPainter>
#include <QPainterPath>
#include <QTimer>
#include <QPropertyAnimation>
#include <QEasingCurve>

AuthWindow::AuthWindow(QWidget *parent)
    : QMainWindow(parent)
    , stackedWidget(nullptr)
    , regPage(nullptr)
    , regEmail(nullptr)
    , regUser(nullptr)
    , regPass(nullptr)
    , regConfirmPass(nullptr)
    , regBtn(nullptr)
    , toLoginBtn(nullptr)
    , loginPage(nullptr)
    , loginUser(nullptr)
    , loginPass(nullptr)
    , loginBtn(nullptr)
    , toRegBtn(nullptr)
    , titleBarWidget(nullptr)
    , m_dragging(false)
{
    setupUI();
    setupConnections();
    
    setWindowTitle("SoundSpace");
    setFixedSize(500, 650);
    setWindowFlags(Qt::FramelessWindowHint);
}

AuthWindow::~AuthWindow()
{
}

bool AuthWindow::eventFilter(QObject *obj, QEvent *event)
{
    if (titleBarWidget && obj == titleBarWidget) {
        if (event->type() == QEvent::MouseButtonPress) {
            QMouseEvent *mouseEvent = static_cast<QMouseEvent*>(event);
            if (mouseEvent->button() == Qt::LeftButton) {
                m_dragging = true;
                m_dragPosition = mouseEvent->globalPos() - frameGeometry().topLeft();
                return true;
            }
        } else if (event->type() == QEvent::MouseMove && m_dragging) {
            QMouseEvent *mouseEvent = static_cast<QMouseEvent*>(event);
            move(mouseEvent->globalPos() - m_dragPosition);
            return true;
        } else if (event->type() == QEvent::MouseButtonRelease) {
            m_dragging = false;
            return true;
        }
    }
    return QMainWindow::eventFilter(obj, event);
}

void AuthWindow::showMessage(const QString& title, const QString& text, bool isError)
{
    QMessageBox msgBox(this);
    msgBox.setWindowTitle(title);
    msgBox.setText(text);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º–Ω—ã–π —Å—Ç–∏–ª—å
    msgBox.setStyleSheet(R"(
        QMessageBox {
            background-color: #1A1A21;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        QMessageBox QLabel {
            color: white;
            font-size: 14px;
        }
        QMessageBox QPushButton {
            background-color: #8A2BE2;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            font-weight: 500;
            min-width: 80px;
        }
        QMessageBox QPushButton:hover {
            background-color: #9B4BFF;
        }
    )");
    
    if (isError) {
        msgBox.setIcon(QMessageBox::Critical);
    } else {
        msgBox.setIcon(QMessageBox::Information);
    }
    
    msgBox.exec();
}

void AuthWindow::showSqlInjectionError()
{
    QDialog dialog(this);
    dialog.setWindowFlags(Qt::FramelessWindowHint | Qt::Dialog);
    dialog.setAttribute(Qt::WA_TranslucentBackground);
    dialog.setFixedSize(500, 500); // –£–≤–µ–ª–∏—á–∏–ª–∏ –≤—ã—Å–æ—Ç—É –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    
    QWidget *content = new QWidget(&dialog);
    content->setStyleSheet(R"(
        QWidget {
            background: #1A1A21;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    )");
    
    QVBoxLayout *layout = new QVBoxLayout(content);
    layout->setContentsMargins(30, 30, 30, 30);
    layout->setSpacing(20);
    
    QLabel *titleLabel = new QLabel("–û–ë–ù–ê–†–£–ñ–ï–ù–ê SQL –ò–ù–™–ï–ö–¶–ò–Ø!");
    titleLabel->setStyleSheet(R"(
        QLabel {
            color: #FF4444;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }
    )");
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    QLabel *imageLabel = new QLabel();
    QPixmap pixmap("image.png");
    if (pixmap.isNull()) {
        // –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –∏–∑ —Ä–µ—Å—É—Ä—Å–æ–≤
        pixmap.load(":/images/image.png");
    }
    
    if (!pixmap.isNull()) {
        pixmap = pixmap.scaled(200, 250, Qt::KeepAspectRatio, Qt::SmoothTransformation);
        imageLabel->setPixmap(pixmap);
        imageLabel->setAlignment(Qt::AlignCenter);
    } else {
        imageLabel->setText("–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ");
        imageLabel->setStyleSheet("color: white; text-align: center;");
    }
    
    QLabel *textLabel = new QLabel(
        "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ SQL –∏–Ω—ä–µ–∫—Ü–∏–∏!\n\n"
        "–ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã:\n"
        "‚Ä¢ –ö–∞–≤—ã—á–∫–∏ (' \")\n"
        "‚Ä¢ –¢–æ—á–∫–∞ —Å –∑–∞–ø—è—Ç–æ–π (;)\n"
        "‚Ä¢ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (--, /* */)\n"
        "‚Ä¢ –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ SQL\n\n"
        "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã."
    );
    textLabel->setStyleSheet(R"(
        QLabel {
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            text-align: center;
        }
    )");
    textLabel->setWordWrap(true);
    
    QPushButton *okButton = new QPushButton("–ü–û–ù–Ø–¢–ù–û");
    okButton->setStyleSheet(R"(
        QPushButton {
            background-color: #FF4444;
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 14px;
            margin-top: 10px;
        }
        QPushButton:hover {
            background-color: #CC3333;
        }
    )");
    connect(okButton, &QPushButton::clicked, &dialog, &QDialog::accept);
    
    layout->addWidget(titleLabel);
    layout->addWidget(imageLabel);
    layout->addWidget(textLabel);
    layout->addWidget(okButton, 0, Qt::AlignCenter);
    
    QVBoxLayout *mainLayout = new QVBoxLayout(&dialog);
    mainLayout->setContentsMargins(0, 0, 0, 0);
    mainLayout->addWidget(content);
    
    dialog.exec();
}

void AuthWindow::setupUI()
{
    // –û—Å–Ω–æ–≤–Ω–æ–π –≤–∏–¥–∂–µ—Ç
    QWidget *central = new QWidget();
    central->setObjectName("centralWidget");
    central->setStyleSheet(R"(
        #centralWidget {
            background: #0F0F14;
            border-radius: 20px;
        }
    )");
    
    setCentralWidget(central);
    
    QVBoxLayout *mainLayout = new QVBoxLayout(central);
    mainLayout->setContentsMargins(0, 0, 0, 0);
    mainLayout->setSpacing(0);
    
    // –ü–∞–Ω–µ–ª—å –∑–∞–≥–æ–ª–æ–≤–∫–∞ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –æ–∫–Ω–∞
    central->setMouseTracking(true);
    central->installEventFilter(this);
    
    QWidget *titleBarWidget = new QWidget();
    titleBarWidget->setFixedHeight(50);
    titleBarWidget->setStyleSheet(R"(
        QWidget {
            background: transparent;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
        }
    )");
    
    QHBoxLayout *titleLayout = new QHBoxLayout(titleBarWidget);
    titleLayout->setContentsMargins(20, 0, 20, 0);
    
    QLabel *logo = new QLabel("SoundSpace");
    logo->setStyleSheet(R"(
        QLabel {
            color: #8A2BE2;
            font-size: 20px;
            font-weight: 800;
            background: transparent;
        }
    )");
    
    QWidget *windowButtons = new QWidget();
    QHBoxLayout *buttonsLayout = new QHBoxLayout(windowButtons);
    buttonsLayout->setContentsMargins(0, 0, 0, 0);
    buttonsLayout->setSpacing(5);
    
    QPushButton *minimizeBtn = new QPushButton("‚Äî");
    QPushButton *closeBtn = new QPushButton("√ó");
    
    QString windowBtnStyle = R"(
        QPushButton {
            background: transparent;
            color: rgba(255, 255, 255, 0.6);
            border: none;
            font-size: 20px;
            padding: 0;
            min-width: 30px;
            min-height: 30px;
            border-radius: 4px;
        }
        QPushButton:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        QPushButton#closeBtn:hover {
            background: #FF4444;
            color: white;
        }
    )";
    
    minimizeBtn->setStyleSheet(windowBtnStyle);
    closeBtn->setStyleSheet(windowBtnStyle);
    closeBtn->setObjectName("closeBtn");
    
    buttonsLayout->addWidget(minimizeBtn);
    buttonsLayout->addWidget(closeBtn);
    
    titleLayout->addWidget(logo);
    titleLayout->addStretch();
    titleLayout->addWidget(windowButtons);
    
    // –ö–æ–Ω—Ç–µ–Ω—Ç–Ω–∞—è –æ–±–ª–∞—Å—Ç—å
    QWidget *contentWidget = new QWidget();
    contentWidget->setStyleSheet("background: transparent;");
    
    QVBoxLayout *contentLayout = new QVBoxLayout(contentWidget);
    contentLayout->setContentsMargins(40, 20, 40, 40);
    contentLayout->setSpacing(30);
    
    stackedWidget = new QStackedWidget();
    stackedWidget->setMaximumWidth(400);
    stackedWidget->setMinimumHeight(400);
    
    // === –°—Ç—Ä–∞–Ω–∏—Ü–∞ –õ–û–ì–ò–ù–ê ===
    loginPage = new QWidget();
    loginPage->setObjectName("loginPage");
    QVBoxLayout *loginLayout = new QVBoxLayout(loginPage);
    loginLayout->setContentsMargins(0, 0, 0, 0);
    loginLayout->setSpacing(25);
    
    QLabel *loginTitle = new QLabel("–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç");
    loginTitle->setStyleSheet(R"(
        QLabel {
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            background: transparent;
            border: none;
        }
    )");
    
    QWidget *formWidget = new QWidget();
    formWidget->setObjectName("formWidget");
    QVBoxLayout *formLayout = new QVBoxLayout(formWidget);
    formLayout->setContentsMargins(0, 0, 0, 0);
    formLayout->setSpacing(20);
    
    loginUser = new QLineEdit();
    loginUser->setObjectName("loginUser");
    loginUser->setPlaceholderText("–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
    loginUser->setMinimumHeight(45);
    loginUser->setStyleSheet(R"(
        QLineEdit {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 0 15px;
            color: white;
            font-size: 14px;
        }
        QLineEdit:focus {
            border: 2px solid #8A2BE2;
            background: rgba(138, 43, 226, 0.05);
        }
        QLineEdit::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
    )");
    
    loginPass = new QLineEdit();
    loginPass->setObjectName("loginPass");
    loginPass->setPlaceholderText("–ü–∞—Ä–æ–ª—å");
    loginPass->setEchoMode(QLineEdit::Password);
    loginPass->setMinimumHeight(45);
    loginPass->setStyleSheet(loginUser->styleSheet());
    
    formLayout->addWidget(loginUser);
    formLayout->addWidget(loginPass);
    
    loginBtn = new QPushButton("–í–û–ô–¢–ò");
    loginBtn->setObjectName("loginBtn");
    loginBtn->setMinimumHeight(45);
    loginBtn->setStyleSheet(R"(
        QPushButton {
            background: #8A2BE2;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
        }
        QPushButton:hover {
            background: #9B4BFF;
            transform: translateY(-1px);
        }
        QPushButton:pressed {
            background: #7B1FA2;
            transform: translateY(0px);
        }
    )");
    
    toRegBtn = new QPushButton("–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç");
    toRegBtn->setObjectName("toRegBtn");
    toRegBtn->setStyleSheet(R"(
        QPushButton {
            background: transparent;
            color: #8A2BE2;
            border: 2px solid #8A2BE2;
            border-radius: 10px;
            font-size: 14px;
            padding: 12px;
            font-weight: 500;
        }
        QPushButton:hover {
            background: rgba(138, 43, 226, 0.1);
        }
    )");
    
    loginLayout->addWidget(loginTitle);
    loginLayout->addWidget(formWidget);
    loginLayout->addWidget(loginBtn);
    loginLayout->addWidget(toRegBtn);
    loginLayout->addStretch();
    
    // === –°—Ç—Ä–∞–Ω–∏—Ü–∞ –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò ===
    regPage = new QWidget();
    regPage->setObjectName("regPage");
    QVBoxLayout *regLayout = new QVBoxLayout(regPage);
    regLayout->setContentsMargins(0, 0, 0, 0);
    regLayout->setSpacing(25);
    
    QLabel *regTitle = new QLabel("–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç");
    regTitle->setStyleSheet(loginTitle->styleSheet());
    
    QWidget *regFormWidget = new QWidget();
    regFormWidget->setObjectName("regFormWidget");
    QVBoxLayout *regFormLayout = new QVBoxLayout(regFormWidget);
    regFormLayout->setContentsMargins(0, 0, 0, 0);
    regFormLayout->setSpacing(15);
    
    regEmail = new QLineEdit();
    regEmail->setObjectName("regEmail");
    regEmail->setPlaceholderText("Email –∞–¥—Ä–µ—Å");
    regEmail->setMinimumHeight(40);
    regEmail->setStyleSheet(loginUser->styleSheet());
    
    regUser = new QLineEdit();
    regUser->setObjectName("regUser");
    regUser->setPlaceholderText("–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
    regUser->setMinimumHeight(40);
    regUser->setStyleSheet(loginUser->styleSheet());
    
    regPass = new QLineEdit();
    regPass->setObjectName("regPass");
    regPass->setPlaceholderText("–ü–∞—Ä–æ–ª—å");
    regPass->setEchoMode(QLineEdit::Password);
    regPass->setMinimumHeight(40);
    regPass->setStyleSheet(loginUser->styleSheet());
    
    regConfirmPass = new QLineEdit();
    regConfirmPass->setObjectName("regConfirmPass");
    regConfirmPass->setPlaceholderText("–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å");
    regConfirmPass->setEchoMode(QLineEdit::Password);
    regConfirmPass->setMinimumHeight(40);
    regConfirmPass->setStyleSheet(loginUser->styleSheet());
    
    QLabel *passwordRules = new QLabel(
        "‚úì –ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤\n"
        "‚úì –ë—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã\n"
        "‚úì –ë–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤"
    );
    passwordRules->setStyleSheet(R"(
        QLabel {
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            border: none;
        }
    )");
    passwordRules->setWordWrap(true);
    
    regFormLayout->addWidget(regEmail);
    regFormLayout->addWidget(regUser);
    regFormLayout->addWidget(regPass);
    regFormLayout->addWidget(regConfirmPass);
    regFormLayout->addWidget(passwordRules);
    
    regBtn = new QPushButton("–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø");
    regBtn->setObjectName("regBtn");
    regBtn->setMinimumHeight(45);
    regBtn->setStyleSheet(loginBtn->styleSheet());
    
    toLoginBtn = new QPushButton("–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏");
    toLoginBtn->setObjectName("toLoginBtn");
    toLoginBtn->setStyleSheet(toRegBtn->styleSheet());
    
    regLayout->addWidget(regTitle);
    regLayout->addWidget(regFormWidget);
    regLayout->addWidget(regBtn);
    regLayout->addWidget(toLoginBtn);
    regLayout->addStretch();
    
    stackedWidget->addWidget(loginPage);
    stackedWidget->addWidget(regPage);
    
    contentLayout->addWidget(stackedWidget, 0, Qt::AlignCenter);
    
    mainLayout->addWidget(titleBarWidget);
    mainLayout->addWidget(contentWidget, 1);
    
    // –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–∫–Ω–æ–º
    connect(minimizeBtn, &QPushButton::clicked, this, &QMainWindow::showMinimized);
    connect(closeBtn, &QPushButton::clicked, this, &QMainWindow::close);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º event filter –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –æ–∫–Ω–∞
    central->installEventFilter(this);
    
    stackedWidget->setCurrentIndex(0);
}

void AuthWindow::setupConnections()
{
    connect(toRegBtn, &QPushButton::clicked, this, &AuthWindow::switchToRegister);
    connect(toLoginBtn, &QPushButton::clicked, this, &AuthWindow::switchToLogin);
    
    connect(regBtn, &QPushButton::clicked, this, &AuthWindow::onRegisterClicked);
    connect(loginBtn, &QPushButton::clicked, this, &AuthWindow::onLoginClicked);
}

void AuthWindow::switchToLogin()
{
    stackedWidget->setCurrentIndex(0);
}

void AuthWindow::switchToRegister()
{
    stackedWidget->setCurrentIndex(1);
}

bool AuthWindow::isValidEmail(const QString& email)
{
    QRegularExpression emailRegex(R"(^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$)");
    return emailRegex.match(email).hasMatch();
}

bool AuthWindow::isValidUsername(const QString& username)
{
    QRegularExpression userRegex("^[a-zA-Z0-9_]+$");
    return username.length() >= 3 && userRegex.match(username).hasMatch();
}

bool AuthWindow::isStrongPassword(const QString& password)
{
    if (password.length() < 6) return false;
    
    bool hasLetter = false;
    bool hasDigit = false;
    
    for (const QChar& ch : password) {
        if (ch.isLetter()) hasLetter = true;
        if (ch.isDigit()) hasDigit = true;
    }
    
    return hasLetter && hasDigit;
}

bool AuthWindow::hasSqlInjection(const QString& input)
{
    QStringList sqlKeywords = {"SELECT", "INSERT", "UPDATE", "DELETE", "DROP", "CREATE", 
                              "ALTER", "EXEC", "UNION", "WHERE", "FROM", "TABLE"};
    
    QString upperInput = input.toUpper();
    
    for (const QString& keyword : sqlKeywords) {
        if (upperInput.contains(keyword)) {
            return true;
        }
    }
    
    if (input.contains("'") || input.contains("\"") || input.contains(";") || 
        input.contains("--") || input.contains("/*") || input.contains("*/")) {
        return true;
    }
    
    return false;
}

void AuthWindow::onRegisterClicked()
{
    QString email = regEmail->text().trimmed();
    QString username = regUser->text().trimmed();
    QString password = regPass->text();
    QString confirmPass = regConfirmPass->text();

    if (hasSqlInjection(email) || hasSqlInjection(username) || hasSqlInjection(password)) {
        showSqlInjectionError();
        return;
    }
    
    if (email.isEmpty() || username.isEmpty() || password.isEmpty() || confirmPass.isEmpty()) {
        showMessage("–û—à–∏–±–∫–∞", "–í—Å–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã!");
        return;
    }
    
    if (!isValidEmail(email)) {
        showMessage("–û—à–∏–±–∫–∞", "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email!");
        return;
    }
    
    if (!isValidUsername(username)) {
        showMessage("–û—à–∏–±–∫–∞", "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞ (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è)!");
        return;
    }
    
    if (password != confirmPass) {
        showMessage("–û—à–∏–±–∫–∞", "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!");
        return;
    }
    
    if (!isStrongPassword(password)) {
        showMessage("–û—à–∏–±–∫–∞", "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤, –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã!");
        return;
    }
    
    regBtn->setEnabled(false);
    regBtn->setText("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...");
    
    QTimer::singleShot(500, [this, username, password]() {
        if (DatabaseManager::instance().registerUser(username, password)) {
            showMessage("–£—Å–ø–µ—Ö", "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!", false);
            switchToLogin();
        } else {
            showMessage("–û—à–∏–±–∫–∞", "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –∑–∞–Ω—è—Ç–æ!");
        }
        
        regBtn->setEnabled(true);
        regBtn->setText("–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø");
    });
}

void AuthWindow::onLoginClicked()
{
    QString username = loginUser->text().trimmed();
    QString password = loginPass->text();
    
    if (hasSqlInjection(username) || hasSqlInjection(password)) {
        showSqlInjectionError();
        return;
    }
    
    if (username.isEmpty() || password.isEmpty()) {
        showMessage("–û—à–∏–±–∫–∞", "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
        return;
    }
    
    loginBtn->setEnabled(false);
    loginBtn->setText("–í—Ö–æ–¥...");
    
    QTimer::singleShot(500, [this, username, password]() {
        if (DatabaseManager::instance().authenticateUser(username, password)) {
            showMainWindow(username);
        } else {
            showMessage("–û—à–∏–±–∫–∞", "–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å!");
            loginBtn->setEnabled(true);
            loginBtn->setText("–í–û–ô–¢–ò");
        }
    });
}

void AuthWindow::showMainWindow(const QString& username)
{
    int userId = DatabaseManager::instance().getUserId(username);
    
    if (userId == -1) {
        showMessage("–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
        return;
    }
    
    MainWindow *mainWindow = new MainWindow(username, userId);
    mainWindow->show();
    
    this->close();
}

=== kursach/src/gui/Frameless/FramelessWindow.cpp ===
#include "FramelessWindow.h"
#include <QApplication>
#include <QDebug>

FramelessWindow::FramelessWindow(QWidget *parent)
    : QMainWindow(parent)
{
    setWindowFlags(Qt::FramelessWindowHint);
    setAttribute(Qt::WA_TranslucentBackground);
    
    // –í–∫–ª—é—á–∞–µ–º —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ
    setAttribute(Qt::WA_NoSystemBackground, false);
    setAttribute(Qt::WA_OpaquePaintEvent, true);
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–Ω—å –æ–∫–Ω—É —Å –±–æ–ª–µ–µ –º—è–≥–∫–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
    QGraphicsDropShadowEffect *shadow = new QGraphicsDropShadowEffect();
    shadow->setBlurRadius(25); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º—ã—Ç–∏–µ
    shadow->setXOffset(0);
    shadow->setYOffset(0);
    shadow->setColor(QColor(0, 0, 0, 40)); // –ë–æ–ª–µ–µ –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Ç–µ–Ω—å
    
    QWidget *central = new QWidget();
    central->setObjectName("windowContent");
    central->setGraphicsEffect(shadow);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞
    central->setAttribute(Qt::WA_NoSystemBackground, false);
    central->setAttribute(Qt::WA_OpaquePaintEvent, true);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –∫–∏—Å—Ç—å —Å —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ–º
    QPalette pal = central->palette();
    pal.setColor(QPalette::Window, QColor(15, 15, 20));
    central->setPalette(pal);
    central->setAutoFillBackground(true);
    
    setCentralWidget(central);
}

void FramelessWindow::mousePressEvent(QMouseEvent *event)
{
    if (event->button() == Qt::LeftButton) {
        m_dragging = true;
        m_dragPosition = event->globalPos() - frameGeometry().topLeft();
        event->accept();
    }
}

void FramelessWindow::mouseMoveEvent(QMouseEvent *event)
{
    if (event->buttons() & Qt::LeftButton && m_dragging) {
        move(event->globalPos() - m_dragPosition);
        event->accept();
    }
}

void FramelessWindow::mouseReleaseEvent(QMouseEvent *event)
{
    if (event->button() == Qt::LeftButton) {
        m_dragging = false;
        event->accept();
    }
}

=== kursach/src/gui/Frameless/FramelessWindow.h ===
#ifndef FRAMELESSWINDOW_H
#define FRAMELESSWINDOW_H

#include <QMainWindow>
#include <QMouseEvent>
#include <QGraphicsDropShadowEffect>

class FramelessWindow : public QMainWindow
{
    Q_OBJECT

public:
    explicit FramelessWindow(QWidget *parent = nullptr);
    
protected:
    void mousePressEvent(QMouseEvent *event) override;
    void mouseMoveEvent(QMouseEvent *event) override;
    void mouseReleaseEvent(QMouseEvent *event) override;
    
private:
    bool m_dragging = false;
    QPoint m_dragPosition;
};

#endif // FRAMELESSWINDOW_H

=== kursach/src/audio/AudioPlayer.cpp ===
#include "AudioPlayer.h"
#include <QSlider>
#include <QLabel>
#include <QToolButton>
#include <QHBoxLayout>
#include <QVBoxLayout>
#include <QStyle>
#include <QTime>
#include <QApplication>
#include <QGraphicsDropShadowEffect>

AudioPlayer::AudioPlayer(QObject *parent)
    : QObject(parent)
    , mediaPlayer(new QMediaPlayer(this))
    , playerControls(nullptr)
    , nowPlayingLabel(nullptr)
    , currentTimeLabel(nullptr)
    , totalTimeLabel(nullptr)
    , progressSlider(nullptr)
    , playPauseBtn(nullptr)
    , previousBtn(nullptr)
    , nextBtn(nullptr)
    , volumeSlider(nullptr)
{
    mediaPlayer->setVolume(50);
}

AudioPlayer::~AudioPlayer()
{
}

void AudioPlayer::setupPlayerControls(QWidget *parent)
{
    playerControls = new QWidget(parent);
    playerControls->setFixedHeight(100);
    playerControls->setStyleSheet(R"(
        QWidget {
            background: rgba(15, 15, 20, 0.95);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
    )");
    
    QHBoxLayout *layout = new QHBoxLayout(playerControls);
    layout->setContentsMargins(30, 15, 30, 15);
    layout->setSpacing(20);
    
    // –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–µ–∫–µ
    QWidget *trackInfoWidget = new QWidget();
    trackInfoWidget->setFixedWidth(250);
    QVBoxLayout *trackLayout = new QVBoxLayout(trackInfoWidget);
    trackLayout->setContentsMargins(0, 0, 0, 0);
    trackLayout->setSpacing(5);
    
    nowPlayingLabel = new QLabel("–ù–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è");
    nowPlayingLabel->setStyleSheet(R"(
        QLabel {
            color: #FFFFFF;
            font-size: 14px;
            font-weight: 600;
            background: transparent;
        }
    )");
    nowPlayingLabel->setWordWrap(true);
    
    QLabel *artistLabel = new QLabel("SoundSpace");
    artistLabel->setStyleSheet(R"(
        QLabel {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            background: transparent;
        }
    )");
    
    trackLayout->addWidget(nowPlayingLabel);
    trackLayout->addWidget(artistLabel);
    layout->addWidget(trackInfoWidget);
    
    // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º
    QWidget *controlsWidget = new QWidget();
    QVBoxLayout *controlsLayout = new QVBoxLayout(controlsWidget);
    controlsLayout->setContentsMargins(0, 0, 0, 0);
    controlsLayout->setSpacing(10);
    
    QHBoxLayout *playbackLayout = new QHBoxLayout();
    playbackLayout->setAlignment(Qt::AlignCenter);
    playbackLayout->setSpacing(15);
    
    // –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–ª–µ–µ—Ä–∞
    QString playerBtnStyle = R"(
        QToolButton {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
        }
        QToolButton:hover {
            color: #FFFFFF;
            background: rgba(255, 255, 255, 0.1);
        }
    )";
    
    previousBtn = new QToolButton();
    previousBtn->setIcon(QIcon::fromTheme("media-skip-backward"));
    previousBtn->setStyleSheet(playerBtnStyle);
    previousBtn->setFixedSize(40, 40);
    
    playPauseBtn = new QToolButton();
    playPauseBtn->setIcon(QIcon::fromTheme("media-playback-start"));
    playPauseBtn->setStyleSheet(R"(
        QToolButton {
            background: #8A2BE2;
            border: none;
            border-radius: 20px;
            color: white;
            padding: 10px;
        }
        QToolButton:hover {
            background: #9B4BFF;
        }
    )");
    playPauseBtn->setFixedSize(50, 50);
    
    nextBtn = new QToolButton();
    nextBtn->setIcon(QIcon::fromTheme("media-skip-forward"));
    nextBtn->setStyleSheet(playerBtnStyle);
    nextBtn->setFixedSize(40, 40);
    
    playbackLayout->addWidget(previousBtn);
    playbackLayout->addWidget(playPauseBtn);
    playbackLayout->addWidget(nextBtn);
    
    // –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä —Å –≤—Ä–µ–º–µ–Ω–µ–º
    QHBoxLayout *progressLayout = new QHBoxLayout();
    progressLayout->setSpacing(10);
    
    currentTimeLabel = new QLabel("0:00");
    currentTimeLabel->setStyleSheet(R"(
        QLabel {
            color: rgba(255, 255, 255, 0.5);
            font-size: 11px;
            min-width: 40px;
        }
    )");
    
    progressSlider = new QSlider(Qt::Horizontal);
    progressSlider->setStyleSheet(R"(
        QSlider::groove:horizontal {
            background: rgba(255, 255, 255, 0.1);
            height: 4px;
            border-radius: 2px;
        }
        QSlider::sub-page:horizontal {
            background: #8A2BE2;
            border-radius: 2px;
        }
        QSlider::handle:horizontal {
            background: #FFFFFF;
            width: 12px;
            height: 12px;
            margin: -4px 0;
            border-radius: 6px;
        }
        QSlider::handle:horizontal:hover {
            background: #8A2BE2;
            width: 14px;
            height: 14px;
            margin: -5px 0;
        }
    )");
    
    totalTimeLabel = new QLabel("0:00");
    totalTimeLabel->setStyleSheet(R"(
        QLabel {
            color: rgba(255, 255, 255, 0.5);
            font-size: 11px;
            min-width: 40px;
        }
    )");
    
    progressLayout->addWidget(currentTimeLabel);
    progressLayout->addWidget(progressSlider, 1);
    progressLayout->addWidget(totalTimeLabel);
    
    controlsLayout->addLayout(playbackLayout);
    controlsLayout->addLayout(progressLayout);
    layout->addWidget(controlsWidget, 1);
    
    // –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    QWidget *rightWidget = new QWidget();
    rightWidget->setFixedWidth(200);
    QHBoxLayout *rightLayout = new QHBoxLayout(rightWidget);
    rightLayout->setContentsMargins(0, 0, 0, 0);
    rightLayout->setSpacing(15);
    
    // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
    QToolButton *likeBtn = new QToolButton();
    likeBtn->setText("‚ô°");
    likeBtn->setStyleSheet(R"(
        QToolButton {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 16px;
        }
        QToolButton:hover {
            color: #FF4444;
        }
        QToolButton[liked="true"] {
            color: #FF4444;
        }
    )");
    
    // –ü–æ–ª–∑—É–Ω–æ–∫ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
    QWidget *volumeWidget = new QWidget();
    QHBoxLayout *volumeLayout = new QHBoxLayout(volumeWidget);
    volumeLayout->setContentsMargins(0, 0, 0, 0);
    volumeLayout->setSpacing(8);
    
    QToolButton *volumeIcon = new QToolButton();
    volumeIcon->setText("üîä");
    volumeIcon->setStyleSheet(playerBtnStyle);
    
    volumeSlider = new QSlider(Qt::Horizontal);
    volumeSlider->setRange(0, 100);
    volumeSlider->setValue(50);
    volumeSlider->setFixedWidth(80);
    volumeSlider->setStyleSheet(R"(
        QSlider::groove:horizontal {
            background: rgba(255, 255, 255, 0.1);
            height: 4px;
            border-radius: 2px;
        }
        QSlider::sub-page:horizontal {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }
        QSlider::handle:horizontal {
            background: #FFFFFF;
            width: 10px;
            height: 10px;
            margin: -3px 0;
            border-radius: 5px;
        }
        QSlider::handle:horizontal:hover {
            background: #8A2BE2;
        }
    )");
    
    volumeLayout->addWidget(volumeIcon);
    volumeLayout->addWidget(volumeSlider);
    
    rightLayout->addWidget(likeBtn);
    rightLayout->addWidget(volumeWidget);
    layout->addWidget(rightWidget);
    
    // –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∏–≥–Ω–∞–ª—ã
    connect(playPauseBtn, &QToolButton::clicked, this, &AudioPlayer::playSelectedTrack);
    connect(previousBtn, &QToolButton::clicked, this, &AudioPlayer::trackFinished);
    connect(nextBtn, &QToolButton::clicked, this, &AudioPlayer::trackFinished);
    connect(progressSlider, &QSlider::sliderMoved, this, &AudioPlayer::seekTrack);
    
    // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π connect –¥–ª—è volumeSlider
    connect(volumeSlider, &QSlider::valueChanged, this, [this, volumeIcon](int value) {
        mediaPlayer->setVolume(value);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        if (value == 0) {
            volumeIcon->setText("üîá");
        } else if (value < 33) {
            volumeIcon->setText("üîà");
        } else if (value < 66) {
            volumeIcon->setText("üîâ");
        } else {
            volumeIcon->setText("üîä");
        }
    });
    
    connect(mediaPlayer, &QMediaPlayer::positionChanged, this, &AudioPlayer::onPositionChanged);
    connect(mediaPlayer, &QMediaPlayer::durationChanged, this, &AudioPlayer::onDurationChanged);
    connect(mediaPlayer, &QMediaPlayer::stateChanged, this, &AudioPlayer::onPlaybackStateChanged);
    
    // –ö–Ω–æ–ø–∫–∞ –ª–∞–π–∫–∞
    connect(likeBtn, &QToolButton::clicked, likeBtn, [likeBtn]() {
        bool liked = likeBtn->property("liked").toBool();
        likeBtn->setProperty("liked", !liked);
        likeBtn->setStyleSheet(likeBtn->styleSheet());
        likeBtn->setText(!liked ? "‚ù§Ô∏è" : "‚ô°");
    });
}

void AudioPlayer::playTrack(const QString& filePath)
{
    mediaPlayer->setMedia(QUrl::fromLocalFile(filePath));
    mediaPlayer->play();
}

void AudioPlayer::pauseTrack()
{
    if (mediaPlayer->state() == QMediaPlayer::PlayingState) {
        mediaPlayer->pause();
    } else {
        mediaPlayer->play();
    }
}

void AudioPlayer::setVolume(int volume)
{
    mediaPlayer->setVolume(volume);
    volumeSlider->setValue(volume);
}

void AudioPlayer::seek(int position)
{
    mediaPlayer->setPosition(position);
}

bool AudioPlayer::isPlaying() const
{
    return mediaPlayer->state() == QMediaPlayer::PlayingState;
}

QString AudioPlayer::formatTime(qint64 milliseconds)
{
    qint64 seconds = milliseconds / 1000;
    qint64 minutes = seconds / 60;
    seconds = seconds % 60;
    return QString("%1:%2").arg(minutes).arg(seconds, 2, 10, QChar('0'));
}

void AudioPlayer::playSelectedTrack()
{
    pauseTrack();
}

void AudioPlayer::onPositionChanged(qint64 position)
{
    if (!progressSlider->isSliderDown()) {
        progressSlider->setValue(position);
    }
    currentTimeLabel->setText(formatTime(position));
}

void AudioPlayer::onDurationChanged(qint64 duration)
{
    progressSlider->setRange(0, duration);
    totalTimeLabel->setText(formatTime(duration));
}

void AudioPlayer::seekTrack(int position)
{
    mediaPlayer->setPosition(position);
}

void AudioPlayer::onPlaybackStateChanged()
{
    updatePlaybackButtons();
}

void AudioPlayer::updatePlaybackButtons()
{
    if (mediaPlayer->state() == QMediaPlayer::PlayingState) {
        playPauseBtn->setIcon(QIcon::fromTheme("media-playback-pause"));
    } else {
        playPauseBtn->setIcon(QIcon::fromTheme("media-playback-start"));
    }
}

void AudioPlayer::updateTrackInfo(const QString& title, const QString& artist)
{
    if (nowPlayingLabel) {
        nowPlayingLabel->setText(title);
        // –û–±–Ω–æ–≤–ª—è–µ–º artistLabel –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        QLabel *artistLabel = nowPlayingLabel->parentWidget()->findChild<QLabel*>();
        if (artistLabel) {
            artistLabel->setText(artist);
        }
    }
}

=== kursach/src/audio/TrackWidget.cpp ===
#include "TrackWidget.h"
#include <QLabel>
#include <QPushButton>
#include <QVBoxLayout>
#include <QHBoxLayout>

TrackWidget::TrackWidget(const QString& title, const QString& artist, const QString& duration, int trackId, QWidget *parent)
    : QWidget(parent), m_trackId(trackId)
{
    QHBoxLayout *layout = new QHBoxLayout(this);
    layout->setContentsMargins(10, 5, 10, 5);
    
    QVBoxLayout *textLayout = new QVBoxLayout();
    textLayout->setSpacing(2);
    
    QLabel *titleLabel = new QLabel(title);
    titleLabel->setStyleSheet("QLabel { color: white; font-weight: bold; font-size: 14px; }");
    
    QLabel *artistLabel = new QLabel(artist);
    artistLabel->setStyleSheet("QLabel { color: #BBBBBB; font-size: 12px; }");
    
    textLayout->addWidget(titleLabel);
    textLayout->addWidget(artistLabel);
    
    QLabel *durationLabel = new QLabel(duration);
    durationLabel->setStyleSheet("QLabel { color: #BBBBBB; font-size: 12px; }");
    
    QPushButton *playBtn = new QPushButton("‚ñ∂");
    playBtn->setFixedSize(30, 30);
    playBtn->setStyleSheet(
        "QPushButton {"
        "   background-color: #8A2BE2;"
        "   color: white;"
        "   border: none;"
        "   border-radius: 15px;"
        "   font-size: 10px;"
        "}"
        "QPushButton:hover {"
        "   background-color: #7B1FA2;"
        "}"
    );
    
    connect(playBtn, &QPushButton::clicked, [this]() {
        emit playRequested(m_trackId);
    });
    
    layout->addLayout(textLayout);
    layout->addStretch();
    layout->addWidget(durationLabel);
    layout->addWidget(playBtn);
    
    setStyleSheet("TrackWidget { background-color: transparent; }");
    setFixedHeight(50);
}

=== kursach/src/audio/AudioPlayer.h ===
#ifndef AUDIOPLAYER_H
#define AUDIOPLAYER_H

#include <QMediaPlayer>
#include <QWidget>

class QSlider;
class QLabel;
class QToolButton;

class AudioPlayer : public QObject
{
    Q_OBJECT

public:
    explicit AudioPlayer(QObject *parent = nullptr);
    ~AudioPlayer();

    void setupPlayerControls(QWidget *parent);
    QWidget* getPlayerControls() const { return playerControls; }

    void playTrack(const QString& filePath);
    void pauseTrack();
    void setVolume(int volume);
    void seek(int position);

    bool isPlaying() const;
    QString formatTime(qint64 milliseconds);

public slots:
    void playSelectedTrack();
    void onPositionChanged(qint64 position);
    void onDurationChanged(qint64 duration);
    void seekTrack(int position);
    void onPlaybackStateChanged();
    void updatePlaybackButtons();
    void updateTrackInfo(const QString& title, const QString& artist);

signals:
    void trackFinished();

private:
    QMediaPlayer *mediaPlayer;
    QWidget *playerControls;
    QLabel *nowPlayingLabel;
    QLabel *currentTimeLabel;
    QLabel *totalTimeLabel;
    QSlider *progressSlider;
    QToolButton *playPauseBtn;
    QToolButton *previousBtn;
    QToolButton *nextBtn;
    QSlider *volumeSlider;
};

#endif

=== kursach/src/audio/TrackWidget.h ===
#ifndef TRACKWIDGET_H
#define TRACKWIDGET_H

#include <QWidget>

class TrackWidget : public QWidget {
    Q_OBJECT
public:
    explicit TrackWidget(const QString& title, const QString& artist, const QString& duration, int trackId, QWidget *parent = nullptr);
    
signals:
    void playRequested(int trackId);
    void addToPlaylistRequested(int trackId);
    
private:
    int m_trackId;
};

#endif // TRACKWIDGET_H

=== kursach/src/database/models/Track.h ===

























=== kursach/src/database/models/FriendRequest.h ===


















=== kursach/src/database/models/User.h ===




















=== kursach/src/database/models/Playlist.h ===




















=== kursach/src/database/models/PlaylistTracks.h ===



















=== kursach/src/database/DatabaseManager.cpp ===
#include "DatabaseManager.h"
#include <QCryptographicHash>
#include <QDebug>
#include <QSqlError>
#include <QSqlQuery>
#include <QCoreApplication>
#include <QFileInfo>
#include <QDateTime>

QMutex DatabaseManager::m_mutex;

DatabaseManager& DatabaseManager::instance() {
    static DatabaseManager instance;
    return instance;
}

DatabaseManager::DatabaseManager(QObject *parent) 
    : QObject(parent), m_initialized(false) {}

DatabaseManager::~DatabaseManager() {
    if (m_db.isOpen()) {
        m_db.close();
    }
}

bool DatabaseManager::initialize() {
    QMutexLocker locker(&m_mutex);
    
    if (m_initialized && m_db.isOpen()) {
        return true;
    }
    
    return openConnection();
}

bool DatabaseManager::openConnection() {
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ä–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
    if (m_db.isOpen()) {
        m_db.close();
    }
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    m_db = QSqlDatabase::addDatabase("QPSQL", "soundspace_connection");
    
    if (!m_db.isValid()) {
        qDebug() << "‚ùå –î—Ä–∞–π–≤–µ—Ä PostgreSQL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω";
        return false;
    }
    
    // Railway PostgreSQL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    m_db.setHostName("turntable.proxy.rlwy.net");
    m_db.setPort(26533);
    m_db.setDatabaseName("railway");
    m_db.setUserName("postgres");
    m_db.setPassword("VAIWhuipzWQGYBXtLfvtIqXfKyfkxXQS");
    m_db.setConnectOptions("connect_timeout=10");
    
    if (!m_db.open()) {
        qDebug() << "‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:" << m_db.lastError().text();
        return false;
    }
    
    qDebug() << "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ PostgreSQL";
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—ã
    if (!createTables()) {
        qDebug() << "‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü";
        return false;
    }
    
    m_initialized = true;
    return true;
}

bool DatabaseManager::createTables() {
    if (!m_db.isOpen()) {
        return false;
    }
    
    bool success = true;
    
    // –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è)
    QString createUsers = 
        "CREATE TABLE IF NOT EXISTS users ("
        "id SERIAL PRIMARY KEY, "
        "username VARCHAR(50) UNIQUE NOT NULL, "
        "password_hash VARCHAR(64) NOT NULL, "
        "created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP)";
    
    QSqlQuery query(m_db);
    if (!query.exec(createUsers)) {
        qDebug() << "‚ùå –û—à–∏–±–∫–∞ users:" << query.lastError().text();
        success = false;
    }
    
    // –¢–∞–±–ª–∏—Ü–∞ —Ç—Ä–µ–∫–æ–≤ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è)
    QString createTracks = 
        "CREATE TABLE IF NOT EXISTS tracks ("
        "id SERIAL PRIMARY KEY, "
        "file_path TEXT NOT NULL, "
        "file_hash VARCHAR(64) NOT NULL, "
        "user_id INTEGER NOT NULL, "
        "title TEXT NOT NULL, "
        "artist TEXT NOT NULL, "
        "album TEXT, "
        "duration INTEGER DEFAULT 0, "
        "play_count INTEGER DEFAULT 0, "
        "added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, "
        "cover_url TEXT)";
    
    if (!query.exec(createTracks)) {
        qDebug() << "‚ùå –û—à–∏–±–∫–∞ tracks:" << query.lastError().text();
        success = false;
    }
    
    // –¢–∞–±–ª–∏—Ü–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
    QString createPlaylists = 
        "CREATE TABLE IF NOT EXISTS playlists ("
        "id SERIAL PRIMARY KEY, "
        "user_id INTEGER NOT NULL, "
        "name VARCHAR(100) NOT NULL, "
        "created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP)";
    
    if (!query.exec(createPlaylists)) {
        qDebug() << "‚ùå –û—à–∏–±–∫–∞ playlists:" << query.lastError().text();
        success = false;
    }
    
    // –¢–∞–±–ª–∏—Ü–∞ –ø–ª–µ–π–ª–∏—Å—Ç-—Ç—Ä–µ–∫–∏
    QString createPlaylistTracks = 
        "CREATE TABLE IF NOT EXISTS playlist_tracks ("
        "playlist_id INTEGER NOT NULL, "
        "track_id INTEGER NOT NULL, "
        "position INTEGER DEFAULT 0, "
        "PRIMARY KEY (playlist_id, track_id))";
    
    if (!query.exec(createPlaylistTracks)) {
        qDebug() << "‚ùå –û—à–∏–±–∫–∞ playlist_tracks:" << query.lastError().text();
        success = false;
    }
    
    // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (success) {
        QString testPass = hashPassword("test123");
        query.prepare("INSERT INTO users (username, password_hash) "
                     "SELECT 'testuser', ? WHERE NOT EXISTS "
                     "(SELECT 1 FROM users WHERE username = 'testuser')");
        query.addBindValue(testPass);
        query.exec();
    }
    
    return success;
}

bool DatabaseManager::isConnected() const {
    return m_db.isOpen();
}

QString DatabaseManager::hashPassword(const QString& password) {
    return QCryptographicHash::hash(password.toUtf8(), 
                                   QCryptographicHash::Sha256).toHex();
}

QString DatabaseManager::generateFileHash(const QString& filePath) {
    QString uniqueString = QString("%1_%2").arg(filePath).arg(QDateTime::currentMSecsSinceEpoch());
    return QCryptographicHash::hash(uniqueString.toUtf8(), 
                                   QCryptographicHash::Md5).toHex();
}

bool DatabaseManager::registerUser(const QString& username, const QString& password) {
    QMutexLocker locker(&m_mutex);
    
    if (!m_db.isOpen()) {
        if (!initialize()) return false;
    }
    
    if (username.isEmpty() || password.isEmpty() || username.length() < 3 || password.length() < 6) {
        return false;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    QSqlQuery checkQuery(m_db);
    checkQuery.prepare("SELECT id FROM users WHERE username = ?");
    checkQuery.addBindValue(username);
    
    if (checkQuery.exec() && checkQuery.next()) {
        qDebug() << "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:" << username;
        return false;
    }
    
    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    QSqlQuery insertQuery(m_db);
    insertQuery.prepare("INSERT INTO users (username, password_hash) VALUES (?, ?)");
    insertQuery.addBindValue(username);
    insertQuery.addBindValue(hashPassword(password));
    
    bool success = insertQuery.exec();
    if (success) {
        qDebug() << "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:" << username;
    }
    
    return success;
}

bool DatabaseManager::authenticateUser(const QString& username, const QString& password) {
    QMutexLocker locker(&m_mutex);
    
    if (!m_db.isOpen()) {
        if (!initialize()) return false;
    }
    
    QSqlQuery query(m_db);
    query.prepare("SELECT id, password_hash FROM users WHERE username = ?");
    query.addBindValue(username);
    
    if (!query.exec() || !query.next()) {
        return false;
    }
    
    QString storedHash = query.value("password_hash").toString();
    QString inputHash = hashPassword(password);
    
    return (storedHash == inputHash);
}

int DatabaseManager::getUserId(const QString& username) {
    QMutexLocker locker(&m_mutex);
    
    if (!m_db.isOpen()) {
        if (!initialize()) return -1;
    }
    
    QSqlQuery query(m_db);
    query.prepare("SELECT id FROM users WHERE username = ?");
    query.addBindValue(username);
    
    if (query.exec() && query.next()) {
        return query.value("id").toInt();
    }
    
    return -1;
}

bool DatabaseManager::addTrack(const QString& filePath, const QString& title, 
                              const QString& artist, const QString& album, 
                              int duration, int userId) {
    QMutexLocker locker(&m_mutex);
    
    if (!m_db.isOpen()) {
        if (!initialize()) return false;
    }
    
    QString fileHash = generateFileHash(filePath);
    
    QSqlQuery query(m_db);
    query.prepare(
        "INSERT INTO tracks (file_path, file_hash, user_id, title, artist, album, duration) "
        "VALUES (?, ?, ?, ?, ?, ?, ?)"
    );
    
    query.addBindValue(filePath);
    query.addBindValue(fileHash);
    query.addBindValue(userId);
    query.addBindValue(title);
    query.addBindValue(artist);
    query.addBindValue(album);
    query.addBindValue(duration);
    
    bool success = query.exec();
    if (success) {
        qDebug() << "‚úÖ –¢—Ä–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω:" << title << "-" << artist;
    }
    
    return success;
}

QList<Track> DatabaseManager::getUserTracks(int userId) {
    QList<Track> tracks;
    QMutexLocker locker(&m_mutex);
    
    if (!m_db.isOpen()) {
        if (!initialize()) return tracks;
    }
    
    QSqlQuery query(m_db);
    query.prepare(
        "SELECT id, file_path, file_hash, title, artist, album, duration, "
        "play_count, added_at "
        "FROM tracks WHERE user_id = ? ORDER BY added_at DESC"
    );
    query.addBindValue(userId);
    
    if (query.exec()) {
        while (query.next()) {
            Track track;
            track.id = query.value("id").toInt();
            track.filePath = query.value("file_path").toString();
            track.fileHash = query.value("file_hash").toString();
            track.title = query.value("title").toString();
            track.artist = query.value("artist").toString();
            track.album = query.value("album").toString();
            track.duration = query.value("duration").toInt();
            track.playCount = query.value("play_count").toInt();
            track.addedAt = query.value("added_at").toString();
            
            tracks.append(track);
        }
    }
    
    return tracks;
}

bool DatabaseManager::incrementPlayCount(int trackId) {
    QMutexLocker locker(&m_mutex);
    
    if (!m_db.isOpen()) {
        if (!initialize()) return false;
    }
    
    QSqlQuery query(m_db);
    query.prepare("UPDATE tracks SET play_count = play_count + 1 WHERE id = ?");
    query.addBindValue(trackId);
    
    return query.exec();
}

bool DatabaseManager::deleteTrack(int trackId) {
    QMutexLocker locker(&m_mutex);
    
    if (!m_db.isOpen()) {
        if (!initialize()) return false;
    }
    
    // –£–¥–∞–ª—è–µ–º —Å–Ω–∞—á–∞–ª–∞ –∏–∑ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
    QSqlQuery deleteFromPlaylists(m_db);
    deleteFromPlaylists.prepare("DELETE FROM playlist_tracks WHERE track_id = ?");
    deleteFromPlaylists.addBindValue(trackId);
    deleteFromPlaylists.exec();
    
    // –£–¥–∞–ª—è–µ–º —Å–∞–º —Ç—Ä–µ–∫
    QSqlQuery deleteTrackQuery(m_db);
    deleteTrackQuery.prepare("DELETE FROM tracks WHERE id = ?");
    deleteTrackQuery.addBindValue(trackId);
    
    bool success = deleteTrackQuery.exec();
    if (success) {
        qDebug() << "‚úÖ –¢—Ä–µ–∫ —É–¥–∞–ª–µ–Ω, ID:" << trackId;
    }
    
    return success;
}

bool DatabaseManager::addTrackFromAPI(int userId, const QString& title, 
                                     const QString& artist, const QString& coverUrl,
                                     const QString& album, int duration,
                                     const QString& genre) {
    QMutexLocker locker(&m_mutex);
    
    if (!m_db.isOpen()) {
        if (!initialize()) return false;
    }
    
    QString virtualPath = QString("lastfm://%1/%2").arg(artist).arg(title);
    QString fileHash = generateFileHash(virtualPath);
    
    QSqlQuery query(m_db);
    query.prepare(
        "INSERT INTO tracks (file_path, file_hash, user_id, title, artist, "
        "album, duration, cover_url) "
        "VALUES (?, ?, ?, ?, ?, ?, ?, ?)"
    );
    
    query.addBindValue(virtualPath);
    query.addBindValue(fileHash);
    query.addBindValue(userId);
    query.addBindValue(title);
    query.addBindValue(artist);
    query.addBindValue(album);
    query.addBindValue(duration);
    query.addBindValue(coverUrl);
    
    bool success = query.exec();
    if (success) {
        qDebug() << "‚úÖ API —Ç—Ä–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω:" << title << "-" << artist;
    }
    
    return success;
}

=== kursach/src/database/DatabaseManager.h ===
#ifndef DATABASEMANAGER_H
#define DATABASEMANAGER_H

#include <QSqlDatabase>
#include <QString>
#include <QList>
#include <QMutex>
#include <QObject>

struct Track {
    int id;
    QString filePath;
    QString fileHash;
    QString title;
    QString artist;
    QString album;
    int duration;
    int playCount;
    QString addedAt;
};

struct Playlist {
    int id;
    int userId;
    QString name;
    QString createdAt;
};

class DatabaseManager : public QObject
{
    Q_OBJECT

public:
    static DatabaseManager& instance();
    
    // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    bool initialize();
    bool isConnected() const;
    
    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
    bool registerUser(const QString& username, const QString& password);
    bool authenticateUser(const QString& username, const QString& password);
    int getUserId(const QString& username);
    
    // –¢—Ä–µ–∫–∏
    bool addTrack(const QString& filePath, const QString& title, 
                 const QString& artist, const QString& album, 
                 int duration, int userId);
    QList<Track> getUserTracks(int userId);
    bool incrementPlayCount(int trackId);
    bool deleteTrack(int trackId);
    
    // API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
 bool addTrackFromAPI(int userId, const QString& title, 
                    const QString& artist, const QString& coverUrl,
                    const QString& album = "", int duration = 0,
                    const QString& genre = "");
    
private:
    DatabaseManager(QObject *parent = nullptr);
    ~DatabaseManager();
    DatabaseManager(const DatabaseManager&) = delete;
    DatabaseManager& operator=(const DatabaseManager&) = delete;
    
    bool openConnection();
    bool createTables();
    QString hashPassword(const QString& password);
    QString generateFileHash(const QString& filePath);
    
    QSqlDatabase m_db;
    static QMutex m_mutex;
    bool m_initialized;
};

#endif // DATABASEMANAGER_H

=== kursach/src/database/api/MusicAPIManager.h ===
#ifndef MUSICAPIMANAGER_H
#define MUSICAPIMANAGER_H

#include <QObject>
#include <QNetworkAccessManager>
#include <QNetworkReply>
#include <QJsonDocument>
#include <QJsonObject>
#include <QJsonArray>
#include <QUrlQuery>
#include <QVariant>
#include "../../gui/Frameless/FramelessWindow.h"

class MusicAPIManager : public QObject
{
    Q_OBJECT

public:
    explicit MusicAPIManager(QObject *parent = nullptr);
    
    void searchTracks(const QString& query, int userId);
    void getTopTracks(int userId);

signals:
    void tracksFound(const QVariantList& tracks);
    void errorOccurred(const QString& error);

private slots:
    void handleNetworkResponse(QNetworkReply *reply);

private:
    QNetworkAccessManager *m_networkManager;
    QString m_apiKey;
    QString m_baseUrl;
    int m_currentUserId;
    
    void processTracksData(const QJsonArray& tracksArray);
    void processSearchResponse(const QByteArray& responseData);        
    void processTopTracksResponse(const QByteArray& responseData);  
};

#endif 


=== kursach/src/database/api/MusicAPIManager.cpp ===
#include "../../database/api/MusicAPIManager.h"
#include "../../database/DatabaseManager.h"
#include <QDebug>
#include <QSslError>

MusicAPIManager::MusicAPIManager(QObject *parent) 
    : QObject(parent)
    , m_networkManager(new QNetworkAccessManager(this))
    , m_apiKey("5d63cb6ba6780da3f1306e10539e4b01")  
    , m_baseUrl("https://ws.audioscrobbler.com/2.0/")
    , m_currentUserId(-1)
{
    qDebug() << "MusicAPIManager initialized";
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–µ–≤–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
    m_networkManager->setRedirectPolicy(QNetworkRequest::NoLessSafeRedirectPolicy);
    
    // –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    connect(m_networkManager, &QNetworkAccessManager::finished,
            this, &MusicAPIManager::handleNetworkResponse);
}

void MusicAPIManager::searchTracks(const QString& query, int userId)
{
    m_currentUserId = userId;
    
    qDebug() << "=== SEARCH TRACKS START ===";
    qDebug() << "Query:" << query;
    qDebug() << "User ID:" << userId;
    
    QUrl url(m_baseUrl);
    QUrlQuery params;
    params.addQueryItem("method", "track.search");
    params.addQueryItem("track", query);
    params.addQueryItem("api_key", m_apiKey);
    params.addQueryItem("format", "json");
    params.addQueryItem("limit", "10");
    
    url.setQuery(params);
    
    qDebug() << "Request URL:" << url.toString();
    
    QNetworkRequest request(url);
    m_networkManager->get(request);
}

void MusicAPIManager::getTopTracks(int userId)
{
    m_currentUserId = userId;
    
    qDebug() << "=== TOP TRACKS START ===";
    qDebug() << "User ID:" << userId;
    
    QUrl url(m_baseUrl);
    QUrlQuery params;
    params.addQueryItem("method", "chart.gettoptracks");
    params.addQueryItem("api_key", m_apiKey);
    params.addQueryItem("format", "json");
    params.addQueryItem("limit", "10");
    
    url.setQuery(params);
    
    qDebug() << "Request URL:" << url.toString();
    
    QNetworkRequest request(url);
    m_networkManager->get(request);
}

void MusicAPIManager::handleNetworkResponse(QNetworkReply *reply)
{
    if (!reply) {
        qDebug() << "No reply object!";
        return;
    }
    
    qDebug() << "\n=== NETWORK RESPONSE ===";
    qDebug() << "URL:" << reply->url().toString();
    qDebug() << "Error:" << reply->error();
    qDebug() << "Error string:" << reply->errorString();
    
    // –°—Ä–∞–∑—É —á–∏—Ç–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
    QByteArray responseData = reply->readAll();
    qDebug() << "Response size:" << responseData.size() << "bytes";
    
    if (responseData.isEmpty()) {
        qDebug() << "Empty response!";
        reply->deleteLater();
        return;
    }
    
    qDebug() << "First 200 chars:" << responseData.left(200);
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∑–∞–ø—Ä–æ—Å–∞ –ø–æ URL
    QString urlString = reply->url().toString();
    
    if (reply->error() == QNetworkReply::NoError) {
        if (urlString.contains("track.search")) {
            processSearchResponse(responseData);
        } else if (urlString.contains("chart.gettoptracks")) {
            processTopTracksResponse(responseData);
        } else {
            qDebug() << "Unknown request type";
        }
    } else {
        qDebug() << "Network error:" << reply->errorString();
        reply->ignoreSslErrors();
    }
    
    reply->deleteLater();
    qDebug() << "=== RESPONSE COMPLETE ===\n";
}

void MusicAPIManager::processTopTracksResponse(const QByteArray& responseData)
{
    QJsonParseError parseError;
    QJsonDocument doc = QJsonDocument::fromJson(responseData, &parseError);
    
    if (parseError.error != QJsonParseError::NoError) {
        qDebug() << "JSON Parse error:" << parseError.errorString();
        qDebug() << "At position:" << parseError.offset;
        qDebug() << "Error context:" << responseData.mid(parseError.offset - 10, 20);
        return;
    }
    
    if (doc.isNull()) {
        qDebug() << "Failed to parse JSON for top tracks";
        return;
    }
    
    QJsonObject root = doc.object();
    
    if (root.contains("error")) {
        qDebug() << "API Error:" << root["error"].toInt() << "-" << root["message"].toString();
        return;
    }
    
    if (root.contains("tracks")) {
        QJsonObject tracksObj = root["tracks"].toObject();
        
        // –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
        qDebug() << "Tracks object keys:" << tracksObj.keys();
        
        if (tracksObj.contains("track")) {
            QJsonArray tracks = tracksObj["track"].toArray();
            qDebug() << "‚úÖ Top tracks results:" << tracks.size() << "tracks found";
            
            // –ü–æ–∫–∞–∂–µ–º –ø–µ—Ä–≤—ã–π —Ç—Ä–µ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            if (!tracks.isEmpty()) {
                QJsonObject firstTrack = tracks.first().toObject();
                qDebug() << "First track name:" << firstTrack["name"].toString();
                qDebug() << "First track artist:" << firstTrack["artist"].toObject()["name"].toString();
            }
            
            processTracksData(tracks);
        } else {
            qDebug() << "No 'track' array in tracks object";
        }
    } else {
        qDebug() << "Unexpected top tracks response structure";
        qDebug() << "Root keys:" << root.keys();
    }
}

void MusicAPIManager::processSearchResponse(const QByteArray& responseData)
{
    QJsonParseError parseError;
    QJsonDocument doc = QJsonDocument::fromJson(responseData, &parseError);
    
    if (parseError.error != QJsonParseError::NoError) {
        qDebug() << "JSON Parse error:" << parseError.errorString();
        qDebug() << "At position:" << parseError.offset;
        return;
    }
    
    if (doc.isNull()) {
        qDebug() << "Failed to parse JSON for search";
        return;
    }
    
    QJsonObject root = doc.object();
    
    if (root.contains("error")) {
        qDebug() << "API Error:" << root["error"].toInt() << "-" << root["message"].toString();
        return;
    }
    
    if (root.contains("results")) {
        QJsonObject results = root["results"].toObject();
        QJsonObject trackMatches = results["trackmatches"].toObject();
        QJsonArray tracks = trackMatches["track"].toArray();
        
        qDebug() << "‚úÖ Search results:" << tracks.size() << "tracks found";
        
        // –ü–æ–∫–∞–∂–µ–º –ø–µ—Ä–≤—ã–π —Ç—Ä–µ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        if (!tracks.isEmpty()) {
            QJsonObject firstTrack = tracks.first().toObject();
            qDebug() << "First search track:" << firstTrack["name"].toString() << "-" << firstTrack["artist"].toString();
        }
        
        processTracksData(tracks);
    } else {
        qDebug() << "Unexpected search response structure";
        qDebug() << "Root keys:" << root.keys();
    }
}

void MusicAPIManager::processTracksData(const QJsonArray& tracksArray)
{
    QVariantList processedTracks;
    
    for (const QJsonValue &trackValue : tracksArray) {
        QJsonObject trackObj = trackValue.toObject();
        
        QVariantMap track;
        
        // –î–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –ø–æ–∏—Å–∫–æ–≤—ã—Ö
        if (trackObj.contains("artist") && trackObj["artist"].isObject()) {
            // –≠—Ç–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Ç—Ä–µ–∫ - artist —ç—Ç–æ –æ–±—ä–µ–∫—Ç
            QJsonObject artistObj = trackObj["artist"].toObject();
            track["artist"] = artistObj["name"].toString();
        } else {
            // –≠—Ç–æ –ø–æ–∏—Å–∫–æ–≤—ã–π —Ç—Ä–µ–∫ - artist —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞
            track["artist"] = trackObj.contains("artist") ? 
                             (trackObj["artist"].isString() ? trackObj["artist"].toString() : 
                              "Unknown Artist") : "Unknown Artist";
        }
        
        track["title"] = trackObj["name"].toString();
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        QString coverUrl;
        if (trackObj.contains("image")) {
            QJsonArray images = trackObj["image"].toArray();
            if (!images.isEmpty()) {
                // –ë–µ—Ä–µ–º —Å–∞–º–æ–µ –±–æ–ª—å—à–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤ –º–∞—Å—Å–∏–≤–µ)
                for (int i = images.size() - 1; i >= 0; --i) {
                    QString imageUrl = images[i].toObject()["#text"].toString();
                    if (!imageUrl.isEmpty()) {
                        coverUrl = imageUrl;
                        break;
                    }
                }
            }
        }
        
        track["coverUrl"] = coverUrl;

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        if (trackObj.contains("listeners")) {
            track["listeners"] = trackObj["listeners"].toString();
        }
        if (trackObj.contains("playcount")) {
            track["playcount"] = trackObj["playcount"].toString();
        }
        
        processedTracks.append(track);
        
        qDebug() << "Processing track:" << track["title"].toString() << "-" << track["artist"].toString();
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î - –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ —Å 4 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
        DatabaseManager::instance().addTrackFromAPI(
            m_currentUserId,
            track["title"].toString(),
            track["artist"].toString(),
            coverUrl
        );
    }
    
    qDebug() << "Emitting tracksFound signal with" << processedTracks.size() << "tracks";
    emit tracksFound(processedTracks);
}

=== kursach/src/main.cpp ===
#include <QApplication>
#include <QDebug>
#include <QMessageBox>
#include <QFile>
#include <QDir>

#include "gui/AuthWindow/AuthWindow.h"
#include "database/DatabaseManager.h"

int main(int argc, char *argv[])
{
    QApplication app(argc, argv);
    
    qDebug() << "==========================================";
    qDebug() << "–ó–∞–ø—É—Å–∫ SoundSpace...";
    qDebug() << "==========================================";
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    QApplication::setApplicationName("SoundSpace");
    QApplication::setOrganizationName("SoundSpace");
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
    QFile styleFile(":/styles/styles.css");
    if (styleFile.open(QIODevice::ReadOnly)) {
        QString styleSheet = QLatin1String(styleFile.readAll());
        app.setStyleSheet(styleSheet);
        qDebug() << "‚úÖ –°—Ç–∏–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã";
    } else {
        qDebug() << "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∏–ª–∏";
        qDebug() << "–ü—É—Ç—å:" << styleFile.fileName();
        qDebug() << "–†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:" << QDir::currentPath();
    }
    
    qDebug() << "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...";
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
    if (!DatabaseManager::instance().initialize()) {
        qDebug() << "‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö";
        
        QMessageBox msgBox;
        msgBox.setWindowTitle("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è");
        msgBox.setText("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.\n"
                      "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.");
        msgBox.setIcon(QMessageBox::Critical);
        msgBox.exec();
        return -1;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    if (!DatabaseManager::instance().isConnected()) {
        qDebug() << "‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö";
        QMessageBox::critical(nullptr, "–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è", 
            "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.");
        return -1;
    }
    
    qDebug() << "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ";
    qDebug() << "==========================================";
    
    // –°–æ–∑–¥–∞–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    AuthWindow authWindow;
    authWindow.show();
    
    qDebug() << "–û–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—É—â–µ–Ω–æ";
    qDebug() << "==========================================";
    
    return app.exec();
}

=== kursach/styles/styles.css ===
/* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö –æ–∫–æ–Ω */
* {
    font-family: 'Segoe UI', Arial, sans-serif;
}

QMainWindow, QWidget {
    background-color: #0F0F14;
}

/* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ */
QLabel {
    text-align: center;
    background-color: transparent;
    color: #FFFFFF;
}

/* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
QLineEdit {
    background-color: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 12px 15px;
    color: white;
    font-size: 14px;
    text-align: center;
}

QLineEdit:focus {
    border: 2px solid #8A2BE2;
    background-color: rgba(138, 43, 226, 0.05);
}

QLineEdit::placeholder {
    color: rgba(255, 255, 255, 0.4);
}

/* –ö–Ω–æ–ø–∫–∏ */
QPushButton {
    background-color: #8A2BE2;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 12px 24px;
    font-weight: 600;
    font-size: 14px;
}

QPushButton:hover {
    background-color: #9B4BFF;
}

QPushButton:pressed {
    background-color: #7B1FA2;
}

/* –í—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
QPushButton#secondary {
    background-color: transparent;
    border: 2px solid #8A2BE2;
    color: #8A2BE2;
}

QPushButton#secondary:hover {
    background-color: rgba(138, 43, 226, 0.1);
}

/* –°–æ–æ–±—â–µ–Ω–∏—è */
QMessageBox {
    background-color: #1A1A21;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
}

QMessageBox QLabel {
    color: rgba(255, 255, 255, 0.9);
    font-size: 14px;
    text-align: center;
    padding: 10px;
}

/* –°–ø–∏—Å–∫–∏ */
QListWidget {
    background-color: rgba(255, 255, 255, 0.03);
    border: 2px solid rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    color: white;
    font-size: 14px;
}

QListWidget::item {
    background-color: transparent;
    padding: 12px 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

QListWidget::item:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

QListWidget::item:selected {
    background-color: rgba(138, 43, 226, 0.2);
    color: #8A2BE2;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
QPushButton#navButton {
    font-size: 15px;
    padding: 12px 18px;
}

/* –ó–∞–ø—Ä–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ */
* {
    -qt-style-hint: none;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Ç–µ–∫—Å—Ç–∞ */
QLabel {
    text-overflow: ellipsis;
}

/* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
QPushButton {
    min-height: 44px;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –æ–∫–æ–Ω */
@media screen and (max-width: 1200px) {
    #roomsPage {
        padding: 20px !important;
    }
    
    QLabel {
        font-size: 14px !important;
    }
    
    QPushButton {
        font-size: 13px !important;
    }
}

/* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ–±—Ä–µ–∑–∞–Ω–∏–µ–º —Ç–µ–∫—Å—Ç–∞ */
QPushButton {
    min-height: 40px;
    max-height: 45px;
    padding: 0 15px !important;
}

/* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
QPushButton:hover {
    background: rgba(138, 43, 226, 0.15) !important;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ */
QLabel {
    text-overflow: ellipsis;
    overflow: hidden;
}

/* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ */
QLabel#statusLabel {
    margin: 0 50px !important;
    min-width: 70px !important;
    max-width: 100px !important;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ */
@media screen and (max-width: 1024px) {
    QPushButton {
        font-size: 13px !important;
        padding: 0 12px !important;
    }
    
    QLabel {
        font-size: 14px !important;
    }
}

/* –§–∏–∫—Å –¥–ª—è Windows */
QWidget {
    font-family: 'Segoe UI', 'Arial', sans-serif;
    font-smooth: always;
}
/* Linux-specific fixes */
* {
    font-family: 'Ubuntu', 'DejaVu Sans', 'Liberation Sans', sans-serif;
}

/* –§–∏–∫—Å –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ Linux */
QPushButton {
    min-height: 44px;
    padding: 10px 15px !important;
}

/* –§–∏–∫—Å –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏ –≤—ã—Ö–æ–¥–∞ */
QPushButton#logoutBtn {
    padding: 12px !important;
    font-size: 15px !important;
    font-weight: 600 !important;
}

/* –§–∏–∫—Å –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –≤ Linux */
QPushButton#statusButton {
    min-height: 30px !important;
    max-height: 35px !important;
    margin: 0 60px !important;
}

/* –§–∏–∫—Å –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–æ–º–Ω–∞—Ç - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –Ω–∞–ª–æ–∂–µ–Ω–∏—è */
QWidget {
    spacing: 10px;
    margin: 5px;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≤ Linux */
QLabel {
    font-smooth: always;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* –§–∏–∫—Å –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≤ Linux */
QScrollBar {
    background-color: rgba(255, 255, 255, 0.05);
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü */
QFrame {
    border-width: 1px;
}

/* –§–∏–∫—Å –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –≤ Linux */
QLineEdit {
    padding: 10px 15px !important;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–ª—è Linux */
@media screen and (max-height: 800px) {
    QPushButton {
        min-height: 40px !important;
        font-size: 13px !important;
    }
    
    QLabel {
        font-size: 13px !important;
    }
}

